"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.handler = void 0;
const aws_sdk_1 = require("aws-sdk");
const backend_request_1 = require("./backend_request");
const meeting_1 = require("./meeting");
const util_1 = require("./util");
var meetingTableName = process.env.MEETING_TABLE_NAME;
var attendeesTableName = process.env.ATTENDEE_TABLE_NAME;
var ddb = new aws_sdk_1.DynamoDB();
const Methods = {
    GET: "GET",
    POST: "POST",
    DELETE: "DELETE",
};
const Resources = {
    Root: "/",
    Meetings: "/meetings",
    Meeting: "/meetings/{meetingName}",
    Attendees: "/meetings/{meetingName}/attendees",
    Attendee: "/meetings/{meetingName}/attendees/{attendeeId}",
    Operation: "/meetings/{meetingName}/attendees/{attendeeId}/operations/{operation}",
};
const Operations = {
    StartTranscribe: "start-transcribe",
    StopTranscribe: "stop-transcribe",
};
const Codes = {
    SUCCESS: "SUCCESS",
    UNKNOWN_RESOURCE: "UNKNOWN_RESOURCE",
    UNKNOWN_METHOD: "UNKNOWN_METHOD",
    TOKEN_ERROR: "TOKEN_ERROR",
    PARAMETER_ERROR: "PARAMETER_ERROR",
    NO_SUCH_A_MEETING_ROOM: "NO_SUCH_A_MEETING_ROOM",
    NO_SUCH_AN_ATTENDEE: "NO_SUCH_AN_ATTENDEE",
};
const handler = (event, context, callback) => {
    console.log(event);
    console.log("resource:", event.resource);
    console.log("pathPArameters:", event.pathParameters);
    console.log("method", event.httpMethod);
    console.log("body", event.body);
    const resource = event.resource;
    const pathParams = event.pathParameters;
    const method = event.httpMethod;
    const body = event.body;
    const accessToken = event.headers["x-flect-access-token"];
    console.log("pathParams", pathParams);
    switch (resource) {
        case Resources.Root:
            handleRoot(accessToken, method, pathParams, body, callback);
            break;
        case Resources.Meetings:
            handleMeetings(accessToken, method, pathParams, body, callback);
            break;
        case Resources.Meeting:
            handleMeeting(accessToken, method, pathParams, body, callback);
            break;
        case Resources.Attendees:
            handleAttendees(accessToken, method, pathParams, body, callback);
            break;
        case Resources.Attendee:
            handleAttendee(accessToken, method, pathParams, body, callback);
            break;
        case Resources.Operation:
            handleOperation(accessToken, method, pathParams, body, callback);
            break;
        default:
            console.log(`Unknwon resource name: ${resource}`);
            const response = (0, util_1.generateResponse)({ success: false, code: Codes.UNKNOWN_RESOURCE });
            callback(null, response);
    }
};
exports.handler = handler;
// (0) Root
const handleRoot = (accessToken, method, pathParams, body, callback) => {
    console.log(`HANDLE ROOT: ${method} ${body}`);
    const response = (0, util_1.generateResponse)({ success: true, code: Codes.SUCCESS });
    callback(null, response);
};
// (1) meetings
const handleMeetings = (accessToken, method, pathParams, body, callback) => {
    console.log(`HANDLE Meetings: ${method} ${body}`);
    switch (method) {
        case Methods.GET:
            handleGetMeetings(accessToken, pathParams, body, callback);
            break;
        case Methods.POST:
            handlePostMeetings(accessToken, pathParams, body, callback);
            break;
        default:
            console.log(`Unknwon method: ${method}`);
            const response = (0, util_1.generateResponse)({ success: false, code: Codes.UNKNOWN_METHOD });
            callback(null, response);
            break;
    }
};
//// (1-1) get meetings
const handleGetMeetings = (accessToken, pathParams, body, callback) => {
    ////// Not implemented
    const response = (0, util_1.generateResponse)({ success: true, code: Codes.SUCCESS });
    callback(null, response);
};
//// (1-2) post meetings
const handlePostMeetings = async (accessToken, pathParams, body, callback) => {
    const params = JSON.parse(body);
    let email;
    try {
        email = await (0, util_1.getEmailFromAccessToken)(accessToken);
    }
    catch (e) {
        console.log(e);
    }
    let res;
    if (email) {
        const result = await (0, meeting_1.createMeeting)({
            email,
            meetingName: params.meetingName,
            region: params.region,
        });
        const httpRes = {
            created: result.created,
            meetingId: result.meetingId,
            meetingName: result.meetingName,
            ownerId: result.ownerId,
        };
        res = {
            success: true,
            code: Codes.SUCCESS,
            data: httpRes,
        };
    }
    else {
        res = {
            success: false,
            code: Codes.TOKEN_ERROR,
        };
    }
    const response = (0, util_1.generateResponse)(res);
    callback(null, response);
};
// (2) meetings
const handleMeeting = (accessToken, method, pathParams, body, callback) => {
    console.log(`HANDLE Meeting: ${method} ${body}`);
    switch (method) {
        case Methods.GET:
            handleGetMeeting(accessToken, pathParams, body, callback);
            break;
        case Methods.DELETE:
            handleDeleteMeeting(accessToken, pathParams, body, callback);
            break;
        default:
            console.log(`Unknwon method: ${method}`);
            const response = (0, util_1.generateResponse)({ success: false, code: Codes.UNKNOWN_METHOD });
            callback(null, response);
            break;
    }
};
//// (2-1) Get Meeting
const handleGetMeeting = async (accessToken, pathParams, body, callback) => {
    let res;
    const meetingName = pathParams["meetingName"];
    let email = "";
    try {
        email = (await (0, util_1.getEmailFromAccessToken)(accessToken)) || "";
    }
    catch (e) {
        res = {
            success: false,
            code: Codes.NO_SUCH_AN_ATTENDEE,
        };
        const response = (0, util_1.generateResponse)(res);
        callback(null, response);
    }
    if (!meetingName) {
        console.log(`parameter error: ${meetingName}`);
        res = {
            success: false,
            code: Codes.PARAMETER_ERROR,
        };
    }
    else {
        const result = await (0, meeting_1.getMeetingInfo)({ email, meetingName });
        if (!result) {
            res = {
                success: false,
                code: Codes.NO_SUCH_A_MEETING_ROOM,
            };
        }
        else {
            const httpRes = {
                meetingName: result.meetingName,
                meetingId: result.meetingId,
                meeting: result.meeting,
                metadata: result.metadata,
                hmmTaskArn: result.hmmTaskArn,
            };
            res = {
                success: true,
                code: Codes.SUCCESS,
                data: result,
            };
        }
    }
    const response = (0, util_1.generateResponse)(res);
    callback(null, response);
};
//// (2-2) Delete Meeting
const handleDeleteMeeting = async (accessToken, pathParams, body, callback) => {
    let res;
    const meetingName = pathParams["meetingName"];
    if (!meetingName) {
        console.log(`parameter error: ${meetingName}`);
        res = {
            success: false,
            code: Codes.PARAMETER_ERROR,
        };
    }
    else {
        await (0, meeting_1.deleteMeeting)({ meetingName });
        res = {
            success: true,
            code: Codes.SUCCESS,
        };
    }
    const response = (0, util_1.generateResponse)(res);
    callback(null, response);
};
// (3) attendees
const handleAttendees = (accessToken, method, pathParams, body, callback) => {
    console.log(`HANDLE attendees: ${method} ${body}`);
    switch (method) {
        case Methods.GET:
            handleGetAttendees(accessToken, pathParams, body, callback);
            break;
        case Methods.POST:
            handlePostAttendees(accessToken, pathParams, body, callback);
            break;
        default:
            console.log(`Unknwon method: ${method}`);
            const response = (0, util_1.generateResponse)({ success: false, code: Codes.UNKNOWN_METHOD });
            callback(null, response);
            break;
    }
};
//// (3-1) Get Attendees
const handleGetAttendees = async (accessToken, pathParams, body, callback) => {
    // let res: ResponseBody;
    // const response = generateResponse(res);
    // callback(null, response);
};
//// (3-2) Post Attendees
const handlePostAttendees = async (accessToken, pathParams, body, callback) => {
    let res;
    const params = JSON.parse(body);
    const joinInfo = await (0, meeting_1.joinMeeting)({
        meetingName: params.meetingName,
        attendeeName: params.attendeeName,
    });
    if ("exception" in joinInfo) {
        const exception = joinInfo;
        if (exception.code === backend_request_1.BackendJoinMeetingExceptionType.NO_MEETING_FOUND) {
            res = {
                success: false,
                code: Codes.NO_SUCH_A_MEETING_ROOM,
            };
        }
        else {
            res = {
                success: false,
                code: Codes.PARAMETER_ERROR,
            };
        }
    }
    else {
        const httpRes = {
            meetingName: joinInfo.meetingName,
            meeting: joinInfo.meeting,
            attendee: joinInfo.attendee,
        };
        res = {
            success: true,
            code: Codes.SUCCESS,
            data: httpRes,
        };
    }
    const response = (0, util_1.generateResponse)(res);
    callback(null, response);
};
// (4) attendees
const handleAttendee = (accessToken, method, pathParams, body, callback) => {
    console.log(`HANDLE attendee: ${method} ${body}`);
    switch (method) {
        case Methods.GET:
            handleGetAttendee(accessToken, pathParams, body, callback);
            break;
        default:
            console.log(`Unknwon method: ${method}`);
            const response = (0, util_1.generateResponse)({ success: false, code: Codes.UNKNOWN_METHOD });
            callback(null, response);
            break;
    }
};
//// (4-1) Get Attendee
const handleGetAttendee = async (accessToken, pathParams, body, callback) => {
    let res;
    const meetingName = pathParams["meetingName"];
    const attendeeId = pathParams["attendeeId"];
    if (!meetingName || !attendeeId) {
        console.log(`parameter error: ${meetingName}, ${attendeeId}`);
        res = {
            success: false,
            code: Codes.PARAMETER_ERROR,
        };
    }
    else {
        const attendeeInfo = await (0, meeting_1.getAttendeeInfo)({ meetingName, attendeeId });
        if ("exception" in attendeeInfo) {
            const exception = attendeeInfo;
            if (exception.code === backend_request_1.BackendGetAttendeeInfoExceptionType.NO_ATTENDEE_FOUND) {
                res = {
                    success: false,
                    code: Codes.NO_SUCH_AN_ATTENDEE,
                };
            }
            else {
                res = {
                    success: false,
                    code: Codes.PARAMETER_ERROR,
                };
            }
        }
        else {
            const httpRes = {
                attendeeId: attendeeInfo.attendeeId,
                attendeeName: attendeeInfo.attendeeName,
            };
            res = {
                success: true,
                code: Codes.SUCCESS,
                data: httpRes,
            };
        }
    }
    const response = (0, util_1.generateResponse)(res);
    callback(null, response);
};
// (5) Operation
const handleOperation = (accessToken, method, pathParams, body, callback) => {
    console.log(`HANDLE operation: ${method} ${body}`);
    const meetingName = pathParams["meetingName"];
    const attendeeId = pathParams["attendeeId"];
    const operation = pathParams["operation"];
    switch (method) {
        case Methods.POST:
            if (operation === Operations.StartTranscribe) {
                handlePostStartTranscribe(accessToken, pathParams, body, callback);
            }
            else if (operation === Operations.StopTranscribe) {
                handlePostStopTranscribe(accessToken, pathParams, body, callback);
            }
            break;
        default:
            console.log(`Unknwon method: ${method}`);
            const response = (0, util_1.generateResponse)({ success: false, code: Codes.UNKNOWN_METHOD });
            callback(null, response);
            break;
    }
};
//// (5-1) start transcribe
const handlePostStartTranscribe = async (accessToken, pathParams, body, callback) => {
    let res;
    const params = JSON.parse(body);
    const meetingName = pathParams["meetingName"];
    const attendeeId = pathParams["attendeeId"];
    //// (1) If there is no meeting, return fai
    let email = "";
    try {
        email = (await (0, util_1.getEmailFromAccessToken)(accessToken)) || "";
    }
    catch (e) {
        res = {
            success: false,
            code: Codes.NO_SUCH_AN_ATTENDEE,
        };
        const response = (0, util_1.generateResponse)(res);
        callback(null, response);
    }
    /// (2)
    (0, meeting_1.startTranscribe)({
        email,
        meetingName,
        lang: params.lang,
    });
    res = {
        success: true,
        code: Codes.SUCCESS,
    };
    const response = (0, util_1.generateResponse)(res);
    callback(null, response);
};
//// (5-2) stop transcribe
const handlePostStopTranscribe = async (accessToken, pathParams, body, callback) => {
    let res;
    const params = JSON.parse(body);
    const meetingName = pathParams["meetingName"];
    const attendeeId = pathParams["attendeeId"];
    //// (1) If there is no meeting, return fai
    let email = "";
    try {
        email = (await (0, util_1.getEmailFromAccessToken)(accessToken)) || "";
    }
    catch (e) {
        res = {
            success: false,
            code: Codes.NO_SUCH_AN_ATTENDEE,
        };
        const response = (0, util_1.generateResponse)(res);
        callback(null, response);
    }
    /// (2)
    (0, meeting_1.stopTranscribe)({
        email,
        meetingName,
    });
    res = {
        success: true,
        code: Codes.SUCCESS,
    };
    const response = (0, util_1.generateResponse)(res);
    callback(null, response);
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9sYW1iZGEyL2luZGV4LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLHFDQUFtQztBQUNuQyx1REFBdUs7QUFHdkssdUNBQXdJO0FBQ3hJLGlDQUFtRTtBQUVuRSxJQUFJLGdCQUFnQixHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsa0JBQW1CLENBQUM7QUFDdkQsSUFBSSxrQkFBa0IsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLG1CQUFvQixDQUFDO0FBQzFELElBQUksR0FBRyxHQUFHLElBQUksa0JBQVEsRUFBRSxDQUFDO0FBRXpCLE1BQU0sT0FBTyxHQUFHO0lBQ1osR0FBRyxFQUFFLEtBQUs7SUFDVixJQUFJLEVBQUUsTUFBTTtJQUNaLE1BQU0sRUFBRSxRQUFRO0NBQ1YsQ0FBQztBQUdYLE1BQU0sU0FBUyxHQUFHO0lBQ2QsSUFBSSxFQUFFLEdBQUc7SUFDVCxRQUFRLEVBQUUsV0FBVztJQUNyQixPQUFPLEVBQUUseUJBQXlCO0lBQ2xDLFNBQVMsRUFBRSxtQ0FBbUM7SUFDOUMsUUFBUSxFQUFFLGdEQUFnRDtJQUMxRCxTQUFTLEVBQUUsdUVBQXVFO0NBQzVFLENBQUM7QUFHWCxNQUFNLFVBQVUsR0FBRztJQUNmLGVBQWUsRUFBRSxrQkFBa0I7SUFDbkMsY0FBYyxFQUFFLGlCQUFpQjtDQUMzQixDQUFDO0FBR1gsTUFBTSxLQUFLLEdBQUc7SUFDVixPQUFPLEVBQUUsU0FBUztJQUNsQixnQkFBZ0IsRUFBRSxrQkFBa0I7SUFDcEMsY0FBYyxFQUFFLGdCQUFnQjtJQUNoQyxXQUFXLEVBQUUsYUFBYTtJQUMxQixlQUFlLEVBQUUsaUJBQWlCO0lBQ2xDLHNCQUFzQixFQUFFLHdCQUF3QjtJQUNoRCxtQkFBbUIsRUFBRSxxQkFBcUI7Q0FDcEMsQ0FBQztBQUdKLE1BQU0sT0FBTyxHQUFHLENBQUMsS0FBVSxFQUFFLE9BQVksRUFBRSxRQUFhLEVBQUUsRUFBRTtJQUMvRCxP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LElBQUEsdUJBQWdCLEVBQUMsR0FBRyxDQUFDLENBQUM7SUFDdkMsUUFBUSxDQUFDLElBQUksRUFBRSxRQUFRLENBQUMsQ0FBQztBQUM3QixDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEeW5hbW9EQiB9IGZyb20gXCJhd3Mtc2RrXCI7XG5pbXBvcnQgeyBCYWNrZW5kR2V0QXR0ZW5kZWVJbmZvRXhjZXB0aW9uLCBCYWNrZW5kR2V0QXR0ZW5kZWVJbmZvRXhjZXB0aW9uVHlwZSwgQmFja2VuZEpvaW5NZWV0aW5nRXhjZXB0aW9uLCBCYWNrZW5kSm9pbk1lZXRpbmdFeGNlcHRpb25UeXBlIH0gZnJvbSBcIi4vYmFja2VuZF9yZXF1ZXN0XCI7XG5pbXBvcnQgeyBTdGFydFRyYW5zY3JpYmVSZXF1ZXN0LCBTdG9wVHJhbnNjcmliZVJlcXVlc3QgfSBmcm9tIFwiLi9jb25zdFwiO1xuaW1wb3J0IHsgSFRUUENyZWF0ZU1lZXRpbmdSZXF1ZXN0LCBIVFRQQ3JlYXRlTWVldGluZ1Jlc3BvbnNlLCBIVFRQR2V0QXR0ZW5kZWVJbmZvUmVzcG9uc2UsIEhUVFBHZXRNZWV0aW5nSW5mb1Jlc3BvbnNlLCBIVFRQSm9pbk1lZXRpbmdSZXF1ZXN0LCBIVFRQSm9pbk1lZXRpbmdSZXNwb25zZSwgSFRUUFJlc3BvbnNlQm9keSB9IGZyb20gXCIuL2h0dHBfcmVxdWVzdFwiO1xuaW1wb3J0IHsgY3JlYXRlTWVldGluZywgZGVsZXRlTWVldGluZywgZ2V0QXR0ZW5kZWVJbmZvLCBnZXRNZWV0aW5nSW5mbywgam9pbk1lZXRpbmcsIHN0YXJ0VHJhbnNjcmliZSwgc3RvcFRyYW5zY3JpYmUgfSBmcm9tIFwiLi9tZWV0aW5nXCI7XG5pbXBvcnQgeyBnZW5lcmF0ZVJlc3BvbnNlLCBnZXRFbWFpbEZyb21BY2Nlc3NUb2tlbiB9IGZyb20gXCIuL3V0aWxcIjtcblxudmFyIG1lZXRpbmdUYWJsZU5hbWUgPSBwcm9jZXNzLmVudi5NRUVUSU5HX1RBQkxFX05BTUUhO1xudmFyIGF0dGVuZGVlc1RhYmxlTmFtZSA9IHByb2Nlc3MuZW52LkFUVEVOREVFX1RBQkxFX05BTUUhO1xudmFyIGRkYiA9IG5ldyBEeW5hbW9EQigpO1xuXG5jb25zdCBNZXRob2RzID0ge1xuICAgIEdFVDogXCJHRVRcIixcbiAgICBQT1NUOiBcIlBPU1RcIixcbiAgICBERUxFVEU6IFwiREVMRVRFXCIsXG59IGFzIGNvbnN0O1xudHlwZSBNZXRob2RzID0gdHlwZW9mIE1ldGhvZHNba2V5b2YgdHlwZW9mIE1ldGhvZHNdO1xuXG5jb25zdCBSZXNvdXJjZXMgPSB7XG4gICAgUm9vdDogXCIvXCIsXG4gICAgTWVldGluZ3M6IFwiL21lZXRpbmdzXCIsXG4gICAgTWVldGluZzogXCIvbWVldGluZ3Mve21lZXRpbmdOYW1lfVwiLFxuICAgIEF0dGVuZGVlczogXCIvbWVldGluZ3Mve21lZXRpbmdOYW1lfS9hdHRlbmRlZXNcIixcbiAgICBBdHRlbmRlZTogXCIvbWVldGluZ3Mve21lZXRpbmdOYW1lfS9hdHRlbmRlZXMve2F0dGVuZGVlSWR9XCIsXG4gICAgT3BlcmF0aW9uOiBcIi9tZWV0aW5ncy97bWVldGluZ05hbWV9L2F0dGVuZGVlcy97YXR0ZW5kZWVJZH0vb3BlcmF0aW9ucy97b3BlcmF0aW9ufVwiLFxufSBhcyBjb25zdDtcbnR5cGUgUmVzb3VyY2VzID0gdHlwZW9mIFJlc291cmNlc1trZXlvZiB0eXBlb2YgUmVzb3VyY2VzXTtcblxuY29uc3QgT3BlcmF0aW9ucyA9IHtcbiAgICBTdGFydFRyYW5zY3JpYmU6IFwic3RhcnQtdHJhbnNjcmliZVwiLFxuICAgIFN0b3BUcmFuc2NyaWJlOiBcInN0b3AtdHJhbnNjcmliZVwiLFxufSBhcyBjb25zdDtcbnR5cGUgT3BlcmF0aW9ucyA9IHR5cGVvZiBPcGVyYXRpb25zW2tleW9mIHR5cGVvZiBPcGVyYXRpb25zXTtcblxuY29uc3QgQ29kZXMgPSB7XG4gICAgU1VDQ0VTUzogXCJTVUNDRVNTXCIsXG4gICAgVU5LTk9XTl9SRVNPVVJDRTogXCJVTktOT1dOX1JFU09VUkNFXCIsXG4gICAgVU5LTk9XTl9NRVRIT0Q6IFwiVU5LTk9XTl9NRVRIT0RcIixcbiAgICBUT0tFTl9FUlJPUjogXCJUT0tFTl9FUlJPUlwiLFxuICAgIFBBUkFNRVRFUl9FUlJPUjogXCJQQVJBTUVURVJfRVJST1JcIixcbiAgICBOT19TVUNIX0FfTUVFVElOR19ST09NOiBcIk5PX1NVQ0hfQV9NRUVUSU5HX1JPT01cIixcbiAgICBOT19TVUNIX0FOX0FUVEVOREVFOiBcIk5PX1NVQ0hfQU5fQVRURU5ERUVcIixcbn0gYXMgY29uc3Q7XG50eXBlIENvZGUgPSB0eXBlb2YgQ29kZXNba2V5b2YgdHlwZW9mIENvZGVzXTtcblxuZXhwb3J0IGNvbnN0IGhhbmRsZXIgPSAoZXZlbnQ6IGFueSwgY29udGV4dDogYW55LCBjYWxsYmFjazogYW55KSA9PiB7XG4gICAgY29uc29sZS5sb2coZXZlbnQpO1xuICAgIGNvbnNvbGUubG9nKFwicmVzb3VyY2U6XCIsIGV2ZW50LnJlc291cmNlKTtcbiAgICBjb25zb2xlLmxvZyhcInBhdGhQQXJhbWV0ZXJzOlwiLCBldmVudC5wYXRoUGFyYW1ldGVycyk7XG4gICAgY29uc29sZS5sb2coXCJtZXRob2RcIiwgZXZlbnQuaHR0cE1ldGhvZCk7XG4gICAgY29uc29sZS5sb2coXCJib2R5XCIsIGV2ZW50LmJvZHkpO1xuXG4gICAgY29uc3QgcmVzb3VyY2UgPSBldmVudC5yZXNvdXJjZTtcbiAgICBjb25zdCBwYXRoUGFyYW1zID0gZXZlbnQucGF0aFBhcmFtZXRlcnM7XG4gICAgY29uc3QgbWV0aG9kID0gZXZlbnQuaHR0cE1ldGhvZDtcbiAgICBjb25zdCBib2R5ID0gZXZlbnQuYm9keTtcbiAgICBjb25zdCBhY2Nlc3NUb2tlbiA9IGV2ZW50LmhlYWRlcnNbXCJ4LWZsZWN0LWFjY2Vzcy10b2tlblwiXTtcblxuICAgIGNvbnNvbGUubG9nKFwicGF0aFBhcmFtc1wiLCBwYXRoUGFyYW1zKTtcblxuICAgIHN3aXRjaCAocmVzb3VyY2UpIHtcbiAgICAgICAgY2FzZSBSZXNvdXJjZXMuUm9vdDpcbiAgICAgICAgICAgIGhhbmRsZVJvb3QoYWNjZXNzVG9rZW4sIG1ldGhvZCwgcGF0aFBhcmFtcywgYm9keSwgY2FsbGJhY2spO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgUmVzb3VyY2VzLk1lZXRpbmdzOlxuICAgICAgICAgICAgaGFuZGxlTWVldGluZ3MoYWNjZXNzVG9rZW4sIG1ldGhvZCwgcGF0aFBhcmFtcywgYm9keSwgY2FsbGJhY2spO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgUmVzb3VyY2VzLk1lZXRpbmc6XG4gICAgICAgICAgICBoYW5kbGVNZWV0aW5nKGFjY2Vzc1Rva2VuLCBtZXRob2QsIHBhdGhQYXJhbXMsIGJvZHksIGNhbGxiYWNrKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFJlc291cmNlcy5BdHRlbmRlZXM6XG4gICAgICAgICAgICBoYW5kbGVBdHRlbmRlZXMoYWNjZXNzVG9rZW4sIG1ldGhvZCwgcGF0aFBhcmFtcywgYm9keSwgY2FsbGJhY2spO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgUmVzb3VyY2VzLkF0dGVuZGVlOlxuICAgICAgICAgICAgaGFuZGxlQXR0ZW5kZWUoYWNjZXNzVG9rZW4sIG1ldGhvZCwgcGF0aFBhcmFtcywgYm9keSwgY2FsbGJhY2spO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgUmVzb3VyY2VzLk9wZXJhdGlvbjpcbiAgICAgICAgICAgIGhhbmRsZU9wZXJhdGlvbihhY2Nlc3NUb2tlbiwgbWV0aG9kLCBwYXRoUGFyYW1zLCBib2R5LCBjYWxsYmFjayk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBVbmtud29uIHJlc291cmNlIG5hbWU6ICR7cmVzb3VyY2V9YCk7XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGdlbmVyYXRlUmVzcG9uc2UoeyBzdWNjZXNzOiBmYWxzZSwgY29kZTogQ29kZXMuVU5LTk9XTl9SRVNPVVJDRSB9KTtcbiAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3BvbnNlKTtcbiAgICB9XG59O1xuXG4vLyAoMCkgUm9vdFxuY29uc3QgaGFuZGxlUm9vdCA9IChhY2Nlc3NUb2tlbjogc3RyaW5nLCBtZXRob2Q6IHN0cmluZywgcGF0aFBhcmFtczogeyBba2V5OiBzdHJpbmddOiBzdHJpbmcgfSwgYm9keTogYW55LCBjYWxsYmFjazogYW55KSA9PiB7XG4gICAgY29uc29sZS5sb2coYEhBTkRMRSBST09UOiAke21ldGhvZH0gJHtib2R5fWApO1xuICAgIGNvbnN0IHJlc3BvbnNlID0gZ2VuZXJhdGVSZXNwb25zZSh7IHN1Y2Nlc3M6IHRydWUsIGNvZGU6IENvZGVzLlNVQ0NFU1MgfSk7XG4gICAgY2FsbGJhY2sobnVsbCwgcmVzcG9uc2UpO1xufTtcblxuLy8gKDEpIG1lZXRpbmdzXG5jb25zdCBoYW5kbGVNZWV0aW5ncyA9IChhY2Nlc3NUb2tlbjogc3RyaW5nLCBtZXRob2Q6IHN0cmluZywgcGF0aFBhcmFtczogeyBba2V5OiBzdHJpbmddOiBzdHJpbmcgfSwgYm9keTogYW55LCBjYWxsYmFjazogYW55KSA9PiB7XG4gICAgY29uc29sZS5sb2coYEhBTkRMRSBNZWV0aW5nczogJHttZXRob2R9ICR7Ym9keX1gKTtcbiAgICBzd2l0Y2ggKG1ldGhvZCkge1xuICAgICAgICBjYXNlIE1ldGhvZHMuR0VUOlxuICAgICAgICAgICAgaGFuZGxlR2V0TWVldGluZ3MoYWNjZXNzVG9rZW4sIHBhdGhQYXJhbXMsIGJvZHksIGNhbGxiYWNrKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIE1ldGhvZHMuUE9TVDpcbiAgICAgICAgICAgIGhhbmRsZVBvc3RNZWV0aW5ncyhhY2Nlc3NUb2tlbiwgcGF0aFBhcmFtcywgYm9keSwgY2FsbGJhY2spO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgVW5rbndvbiBtZXRob2Q6ICR7bWV0aG9kfWApO1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBnZW5lcmF0ZVJlc3BvbnNlKHsgc3VjY2VzczogZmFsc2UsIGNvZGU6IENvZGVzLlVOS05PV05fTUVUSE9EIH0pO1xuICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzcG9uc2UpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgfVxufTtcbi8vLy8gKDEtMSkgZ2V0IG1lZXRpbmdzXG5jb25zdCBoYW5kbGVHZXRNZWV0aW5ncyA9IChhY2Nlc3NUb2tlbjogc3RyaW5nLCBwYXRoUGFyYW1zOiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9LCBib2R5OiBhbnksIGNhbGxiYWNrOiBhbnkpID0+IHtcbiAgICAvLy8vLy8gTm90IGltcGxlbWVudGVkXG4gICAgY29uc3QgcmVzcG9uc2UgPSBnZW5lcmF0ZVJlc3BvbnNlKHsgc3VjY2VzczogdHJ1ZSwgY29kZTogQ29kZXMuU1VDQ0VTUyB9KTtcbiAgICBjYWxsYmFjayhudWxsLCByZXNwb25zZSk7XG59O1xuLy8vLyAoMS0yKSBwb3N0IG1lZXRpbmdzXG5jb25zdCBoYW5kbGVQb3N0TWVldGluZ3MgPSBhc3luYyAoYWNjZXNzVG9rZW46IHN0cmluZywgcGF0aFBhcmFtczogeyBba2V5OiBzdHJpbmddOiBzdHJpbmcgfSwgYm9keTogYW55LCBjYWxsYmFjazogYW55KSA9PiB7XG4gICAgY29uc3QgcGFyYW1zID0gSlNPTi5wYXJzZShib2R5KSBhcyBIVFRQQ3JlYXRlTWVldGluZ1JlcXVlc3Q7XG4gICAgbGV0IGVtYWlsO1xuICAgIHRyeSB7XG4gICAgICAgIGVtYWlsID0gYXdhaXQgZ2V0RW1haWxGcm9tQWNjZXNzVG9rZW4oYWNjZXNzVG9rZW4pO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgY29uc29sZS5sb2coZSk7XG4gICAgfVxuICAgIGxldCByZXM6IEhUVFBSZXNwb25zZUJvZHk7XG4gICAgaWYgKGVtYWlsKSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNyZWF0ZU1lZXRpbmcoe1xuICAgICAgICAgICAgZW1haWwsXG4gICAgICAgICAgICBtZWV0aW5nTmFtZTogcGFyYW1zLm1lZXRpbmdOYW1lLFxuICAgICAgICAgICAgcmVnaW9uOiBwYXJhbXMucmVnaW9uLFxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgaHR0cFJlczogSFRUUENyZWF0ZU1lZXRpbmdSZXNwb25zZSA9IHtcbiAgICAgICAgICAgIGNyZWF0ZWQ6IHJlc3VsdC5jcmVhdGVkLFxuICAgICAgICAgICAgbWVldGluZ0lkOiByZXN1bHQubWVldGluZ0lkLFxuICAgICAgICAgICAgbWVldGluZ05hbWU6IHJlc3VsdC5tZWV0aW5nTmFtZSxcbiAgICAgICAgICAgIG93bmVySWQ6IHJlc3VsdC5vd25lcklkLFxuICAgICAgICB9O1xuICAgICAgICByZXMgPSB7XG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgY29kZTogQ29kZXMuU1VDQ0VTUyxcbiAgICAgICAgICAgIGRhdGE6IGh0dHBSZXMsXG4gICAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgICAgcmVzID0ge1xuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICBjb2RlOiBDb2Rlcy5UT0tFTl9FUlJPUixcbiAgICAgICAgfTtcbiAgICB9XG4gICAgY29uc3QgcmVzcG9uc2UgPSBnZW5lcmF0ZVJlc3BvbnNlKHJlcyk7XG4gICAgY2FsbGJhY2sobnVsbCwgcmVzcG9uc2UpO1xufTtcbi8vICgyKSBtZWV0aW5nc1xuY29uc3QgaGFuZGxlTWVldGluZyA9IChhY2Nlc3NUb2tlbjogc3RyaW5nLCBtZXRob2Q6IHN0cmluZywgcGF0aFBhcmFtczogeyBba2V5OiBzdHJpbmddOiBzdHJpbmcgfSwgYm9keTogYW55LCBjYWxsYmFjazogYW55KSA9PiB7XG4gICAgY29uc29sZS5sb2coYEhBTkRMRSBNZWV0aW5nOiAke21ldGhvZH0gJHtib2R5fWApO1xuICAgIHN3aXRjaCAobWV0aG9kKSB7XG4gICAgICAgIGNhc2UgTWV0aG9kcy5HRVQ6XG4gICAgICAgICAgICBoYW5kbGVHZXRNZWV0aW5nKGFjY2Vzc1Rva2VuLCBwYXRoUGFyYW1zLCBib2R5LCBjYWxsYmFjayk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBNZXRob2RzLkRFTEVURTpcbiAgICAgICAgICAgIGhhbmRsZURlbGV0ZU1lZXRpbmcoYWNjZXNzVG9rZW4sIHBhdGhQYXJhbXMsIGJvZHksIGNhbGxiYWNrKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgY29uc29sZS5sb2coYFVua253b24gbWV0aG9kOiAke21ldGhvZH1gKTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gZ2VuZXJhdGVSZXNwb25zZSh7IHN1Y2Nlc3M6IGZhbHNlLCBjb2RlOiBDb2Rlcy5VTktOT1dOX01FVEhPRCB9KTtcbiAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3BvbnNlKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgIH1cbn07XG4vLy8vICgyLTEpIEdldCBNZWV0aW5nXG5jb25zdCBoYW5kbGVHZXRNZWV0aW5nID0gYXN5bmMgKGFjY2Vzc1Rva2VuOiBzdHJpbmcsIHBhdGhQYXJhbXM6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0sIGJvZHk6IGFueSwgY2FsbGJhY2s6IGFueSkgPT4ge1xuICAgIGxldCByZXM6IEhUVFBSZXNwb25zZUJvZHk7XG4gICAgY29uc3QgbWVldGluZ05hbWUgPSBwYXRoUGFyYW1zW1wibWVldGluZ05hbWVcIl07XG4gICAgbGV0IGVtYWlsID0gXCJcIjtcbiAgICB0cnkge1xuICAgICAgICBlbWFpbCA9IChhd2FpdCBnZXRFbWFpbEZyb21BY2Nlc3NUb2tlbihhY2Nlc3NUb2tlbikpIHx8IFwiXCI7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgICByZXMgPSB7XG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgIGNvZGU6IENvZGVzLk5PX1NVQ0hfQU5fQVRURU5ERUUsXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gZ2VuZXJhdGVSZXNwb25zZShyZXMpO1xuICAgICAgICBjYWxsYmFjayhudWxsLCByZXNwb25zZSk7XG4gICAgfVxuICAgIGlmICghbWVldGluZ05hbWUpIHtcbiAgICAgICAgY29uc29sZS5sb2coYHBhcmFtZXRlciBlcnJvcjogJHttZWV0aW5nTmFtZX1gKTtcbiAgICAgICAgcmVzID0ge1xuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICBjb2RlOiBDb2Rlcy5QQVJBTUVURVJfRVJST1IsXG4gICAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZ2V0TWVldGluZ0luZm8oeyBlbWFpbCwgbWVldGluZ05hbWUgfSk7XG4gICAgICAgIGlmICghcmVzdWx0KSB7XG4gICAgICAgICAgICByZXMgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICAgICAgY29kZTogQ29kZXMuTk9fU1VDSF9BX01FRVRJTkdfUk9PTSxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBodHRwUmVzOiBIVFRQR2V0TWVldGluZ0luZm9SZXNwb25zZSA9IHtcbiAgICAgICAgICAgICAgICBtZWV0aW5nTmFtZTogcmVzdWx0Lm1lZXRpbmdOYW1lLFxuICAgICAgICAgICAgICAgIG1lZXRpbmdJZDogcmVzdWx0Lm1lZXRpbmdJZCxcbiAgICAgICAgICAgICAgICBtZWV0aW5nOiByZXN1bHQubWVldGluZyxcbiAgICAgICAgICAgICAgICBtZXRhZGF0YTogcmVzdWx0Lm1ldGFkYXRhLFxuICAgICAgICAgICAgICAgIGhtbVRhc2tBcm46IHJlc3VsdC5obW1UYXNrQXJuLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHJlcyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgICAgIGNvZGU6IENvZGVzLlNVQ0NFU1MsXG4gICAgICAgICAgICAgICAgZGF0YTogcmVzdWx0LFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb25zdCByZXNwb25zZSA9IGdlbmVyYXRlUmVzcG9uc2UocmVzKTtcbiAgICBjYWxsYmFjayhudWxsLCByZXNwb25zZSk7XG59O1xuXG4vLy8vICgyLTIpIERlbGV0ZSBNZWV0aW5nXG5jb25zdCBoYW5kbGVEZWxldGVNZWV0aW5nID0gYXN5bmMgKGFjY2Vzc1Rva2VuOiBzdHJpbmcsIHBhdGhQYXJhbXM6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0sIGJvZHk6IGFueSwgY2FsbGJhY2s6IGFueSkgPT4ge1xuICAgIGxldCByZXM6IEhUVFBSZXNwb25zZUJvZHk7XG4gICAgY29uc3QgbWVldGluZ05hbWUgPSBwYXRoUGFyYW1zW1wibWVldGluZ05hbWVcIl07XG4gICAgaWYgKCFtZWV0aW5nTmFtZSkge1xuICAgICAgICBjb25zb2xlLmxvZyhgcGFyYW1ldGVyIGVycm9yOiAke21lZXRpbmdOYW1lfWApO1xuICAgICAgICByZXMgPSB7XG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgIGNvZGU6IENvZGVzLlBBUkFNRVRFUl9FUlJPUixcbiAgICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBhd2FpdCBkZWxldGVNZWV0aW5nKHsgbWVldGluZ05hbWUgfSk7XG4gICAgICAgIHJlcyA9IHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgICBjb2RlOiBDb2Rlcy5TVUNDRVNTLFxuICAgICAgICB9O1xuICAgIH1cbiAgICBjb25zdCByZXNwb25zZSA9IGdlbmVyYXRlUmVzcG9uc2UocmVzKTtcbiAgICBjYWxsYmFjayhudWxsLCByZXNwb25zZSk7XG59O1xuXG4vLyAoMykgYXR0ZW5kZWVzXG5jb25zdCBoYW5kbGVBdHRlbmRlZXMgPSAoYWNjZXNzVG9rZW46IHN0cmluZywgbWV0aG9kOiBzdHJpbmcsIHBhdGhQYXJhbXM6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0sIGJvZHk6IGFueSwgY2FsbGJhY2s6IGFueSkgPT4ge1xuICAgIGNvbnNvbGUubG9nKGBIQU5ETEUgYXR0ZW5kZWVzOiAke21ldGhvZH0gJHtib2R5fWApO1xuICAgIHN3aXRjaCAobWV0aG9kKSB7XG4gICAgICAgIGNhc2UgTWV0aG9kcy5HRVQ6XG4gICAgICAgICAgICBoYW5kbGVHZXRBdHRlbmRlZXMoYWNjZXNzVG9rZW4sIHBhdGhQYXJhbXMsIGJvZHksIGNhbGxiYWNrKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIE1ldGhvZHMuUE9TVDpcbiAgICAgICAgICAgIGhhbmRsZVBvc3RBdHRlbmRlZXMoYWNjZXNzVG9rZW4sIHBhdGhQYXJhbXMsIGJvZHksIGNhbGxiYWNrKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgY29uc29sZS5sb2coYFVua253b24gbWV0aG9kOiAke21ldGhvZH1gKTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gZ2VuZXJhdGVSZXNwb25zZSh7IHN1Y2Nlc3M6IGZhbHNlLCBjb2RlOiBDb2Rlcy5VTktOT1dOX01FVEhPRCB9KTtcbiAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3BvbnNlKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgIH1cbn07XG5cbi8vLy8gKDMtMSkgR2V0IEF0dGVuZGVlc1xuY29uc3QgaGFuZGxlR2V0QXR0ZW5kZWVzID0gYXN5bmMgKGFjY2Vzc1Rva2VuOiBzdHJpbmcsIHBhdGhQYXJhbXM6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0sIGJvZHk6IGFueSwgY2FsbGJhY2s6IGFueSkgPT4ge1xuICAgIC8vIGxldCByZXM6IFJlc3BvbnNlQm9keTtcbiAgICAvLyBjb25zdCByZXNwb25zZSA9IGdlbmVyYXRlUmVzcG9uc2UocmVzKTtcbiAgICAvLyBjYWxsYmFjayhudWxsLCByZXNwb25zZSk7XG59O1xuLy8vLyAoMy0yKSBQb3N0IEF0dGVuZGVlc1xuY29uc3QgaGFuZGxlUG9zdEF0dGVuZGVlcyA9IGFzeW5jIChhY2Nlc3NUb2tlbjogc3RyaW5nLCBwYXRoUGFyYW1zOiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9LCBib2R5OiBhbnksIGNhbGxiYWNrOiBhbnkpID0+IHtcbiAgICBsZXQgcmVzOiBIVFRQUmVzcG9uc2VCb2R5O1xuICAgIGNvbnN0IHBhcmFtcyA9IEpTT04ucGFyc2UoYm9keSkgYXMgSFRUUEpvaW5NZWV0aW5nUmVxdWVzdDtcblxuICAgIGNvbnN0IGpvaW5JbmZvID0gYXdhaXQgam9pbk1lZXRpbmcoe1xuICAgICAgICBtZWV0aW5nTmFtZTogcGFyYW1zLm1lZXRpbmdOYW1lLFxuICAgICAgICBhdHRlbmRlZU5hbWU6IHBhcmFtcy5hdHRlbmRlZU5hbWUsXG4gICAgfSk7XG4gICAgaWYgKFwiZXhjZXB0aW9uXCIgaW4gam9pbkluZm8pIHtcbiAgICAgICAgY29uc3QgZXhjZXB0aW9uID0gam9pbkluZm8gYXMgQmFja2VuZEpvaW5NZWV0aW5nRXhjZXB0aW9uO1xuICAgICAgICBpZiAoZXhjZXB0aW9uLmNvZGUgPT09IEJhY2tlbmRKb2luTWVldGluZ0V4Y2VwdGlvblR5cGUuTk9fTUVFVElOR19GT1VORCkge1xuICAgICAgICAgICAgcmVzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGNvZGU6IENvZGVzLk5PX1NVQ0hfQV9NRUVUSU5HX1JPT00sXG4gICAgICAgICAgICB9O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGNvZGU6IENvZGVzLlBBUkFNRVRFUl9FUlJPUixcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBodHRwUmVzOiBIVFRQSm9pbk1lZXRpbmdSZXNwb25zZSA9IHtcbiAgICAgICAgICAgIG1lZXRpbmdOYW1lOiBqb2luSW5mby5tZWV0aW5nTmFtZSxcbiAgICAgICAgICAgIG1lZXRpbmc6IGpvaW5JbmZvLm1lZXRpbmcsXG4gICAgICAgICAgICBhdHRlbmRlZTogam9pbkluZm8uYXR0ZW5kZWUsXG4gICAgICAgIH07XG4gICAgICAgIHJlcyA9IHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgICBjb2RlOiBDb2Rlcy5TVUNDRVNTLFxuICAgICAgICAgICAgZGF0YTogaHR0cFJlcyxcbiAgICAgICAgfTtcbiAgICB9XG4gICAgY29uc3QgcmVzcG9uc2UgPSBnZW5lcmF0ZVJlc3BvbnNlKHJlcyk7XG4gICAgY2FsbGJhY2sobnVsbCwgcmVzcG9uc2UpO1xufTtcblxuLy8gKDQpIGF0dGVuZGVlc1xuY29uc3QgaGFuZGxlQXR0ZW5kZWUgPSAoYWNjZXNzVG9rZW46IHN0cmluZywgbWV0aG9kOiBzdHJpbmcsIHBhdGhQYXJhbXM6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0sIGJvZHk6IGFueSwgY2FsbGJhY2s6IGFueSkgPT4ge1xuICAgIGNvbnNvbGUubG9nKGBIQU5ETEUgYXR0ZW5kZWU6ICR7bWV0aG9kfSAke2JvZHl9YCk7XG4gICAgc3dpdGNoIChtZXRob2QpIHtcbiAgICAgICAgY2FzZSBNZXRob2RzLkdFVDpcbiAgICAgICAgICAgIGhhbmRsZUdldEF0dGVuZGVlKGFjY2Vzc1Rva2VuLCBwYXRoUGFyYW1zLCBib2R5LCBjYWxsYmFjayk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBVbmtud29uIG1ldGhvZDogJHttZXRob2R9YCk7XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGdlbmVyYXRlUmVzcG9uc2UoeyBzdWNjZXNzOiBmYWxzZSwgY29kZTogQ29kZXMuVU5LTk9XTl9NRVRIT0QgfSk7XG4gICAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXNwb25zZSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICB9XG59O1xuXG4vLy8vICg0LTEpIEdldCBBdHRlbmRlZVxuY29uc3QgaGFuZGxlR2V0QXR0ZW5kZWUgPSBhc3luYyAoYWNjZXNzVG9rZW46IHN0cmluZywgcGF0aFBhcmFtczogeyBba2V5OiBzdHJpbmddOiBzdHJpbmcgfSwgYm9keTogYW55LCBjYWxsYmFjazogYW55KSA9PiB7XG4gICAgbGV0IHJlczogSFRUUFJlc3BvbnNlQm9keTtcbiAgICBjb25zdCBtZWV0aW5nTmFtZSA9IHBhdGhQYXJhbXNbXCJtZWV0aW5nTmFtZVwiXTtcbiAgICBjb25zdCBhdHRlbmRlZUlkID0gcGF0aFBhcmFtc1tcImF0dGVuZGVlSWRcIl07XG4gICAgaWYgKCFtZWV0aW5nTmFtZSB8fCAhYXR0ZW5kZWVJZCkge1xuICAgICAgICBjb25zb2xlLmxvZyhgcGFyYW1ldGVyIGVycm9yOiAke21lZXRpbmdOYW1lfSwgJHthdHRlbmRlZUlkfWApO1xuICAgICAgICByZXMgPSB7XG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgIGNvZGU6IENvZGVzLlBBUkFNRVRFUl9FUlJPUixcbiAgICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBhdHRlbmRlZUluZm8gPSBhd2FpdCBnZXRBdHRlbmRlZUluZm8oeyBtZWV0aW5nTmFtZSwgYXR0ZW5kZWVJZCB9KTtcblxuICAgICAgICBpZiAoXCJleGNlcHRpb25cIiBpbiBhdHRlbmRlZUluZm8pIHtcbiAgICAgICAgICAgIGNvbnN0IGV4Y2VwdGlvbiA9IGF0dGVuZGVlSW5mbyBhcyBCYWNrZW5kR2V0QXR0ZW5kZWVJbmZvRXhjZXB0aW9uO1xuICAgICAgICAgICAgaWYgKGV4Y2VwdGlvbi5jb2RlID09PSBCYWNrZW5kR2V0QXR0ZW5kZWVJbmZvRXhjZXB0aW9uVHlwZS5OT19BVFRFTkRFRV9GT1VORCkge1xuICAgICAgICAgICAgICAgIHJlcyA9IHtcbiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIGNvZGU6IENvZGVzLk5PX1NVQ0hfQU5fQVRURU5ERUUsXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVzID0ge1xuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgY29kZTogQ29kZXMuUEFSQU1FVEVSX0VSUk9SLFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBodHRwUmVzOiBIVFRQR2V0QXR0ZW5kZWVJbmZvUmVzcG9uc2UgPSB7XG4gICAgICAgICAgICAgICAgYXR0ZW5kZWVJZDogYXR0ZW5kZWVJbmZvLmF0dGVuZGVlSWQsXG4gICAgICAgICAgICAgICAgYXR0ZW5kZWVOYW1lOiBhdHRlbmRlZUluZm8uYXR0ZW5kZWVOYW1lLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHJlcyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgICAgIGNvZGU6IENvZGVzLlNVQ0NFU1MsXG4gICAgICAgICAgICAgICAgZGF0YTogaHR0cFJlcyxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29uc3QgcmVzcG9uc2UgPSBnZW5lcmF0ZVJlc3BvbnNlKHJlcyk7XG4gICAgY2FsbGJhY2sobnVsbCwgcmVzcG9uc2UpO1xufTtcblxuLy8gKDUpIE9wZXJhdGlvblxuY29uc3QgaGFuZGxlT3BlcmF0aW9uID0gKGFjY2Vzc1Rva2VuOiBzdHJpbmcsIG1ldGhvZDogc3RyaW5nLCBwYXRoUGFyYW1zOiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9LCBib2R5OiBhbnksIGNhbGxiYWNrOiBhbnkpID0+IHtcbiAgICBjb25zb2xlLmxvZyhgSEFORExFIG9wZXJhdGlvbjogJHttZXRob2R9ICR7Ym9keX1gKTtcbiAgICBjb25zdCBtZWV0aW5nTmFtZSA9IHBhdGhQYXJhbXNbXCJtZWV0aW5nTmFtZVwiXTtcbiAgICBjb25zdCBhdHRlbmRlZUlkID0gcGF0aFBhcmFtc1tcImF0dGVuZGVlSWRcIl07XG4gICAgY29uc3Qgb3BlcmF0aW9uID0gcGF0aFBhcmFtc1tcIm9wZXJhdGlvblwiXTtcbiAgICBzd2l0Y2ggKG1ldGhvZCkge1xuICAgICAgICBjYXNlIE1ldGhvZHMuUE9TVDpcbiAgICAgICAgICAgIGlmIChvcGVyYXRpb24gPT09IE9wZXJhdGlvbnMuU3RhcnRUcmFuc2NyaWJlKSB7XG4gICAgICAgICAgICAgICAgaGFuZGxlUG9zdFN0YXJ0VHJhbnNjcmliZShhY2Nlc3NUb2tlbiwgcGF0aFBhcmFtcywgYm9keSwgY2FsbGJhY2spO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChvcGVyYXRpb24gPT09IE9wZXJhdGlvbnMuU3RvcFRyYW5zY3JpYmUpIHtcbiAgICAgICAgICAgICAgICBoYW5kbGVQb3N0U3RvcFRyYW5zY3JpYmUoYWNjZXNzVG9rZW4sIHBhdGhQYXJhbXMsIGJvZHksIGNhbGxiYWNrKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgY29uc29sZS5sb2coYFVua253b24gbWV0aG9kOiAke21ldGhvZH1gKTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gZ2VuZXJhdGVSZXNwb25zZSh7IHN1Y2Nlc3M6IGZhbHNlLCBjb2RlOiBDb2Rlcy5VTktOT1dOX01FVEhPRCB9KTtcbiAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3BvbnNlKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgIH1cbn07XG4vLy8vICg1LTEpIHN0YXJ0IHRyYW5zY3JpYmVcbmNvbnN0IGhhbmRsZVBvc3RTdGFydFRyYW5zY3JpYmUgPSBhc3luYyAoYWNjZXNzVG9rZW46IHN0cmluZywgcGF0aFBhcmFtczogeyBba2V5OiBzdHJpbmddOiBzdHJpbmcgfSwgYm9keTogYW55LCBjYWxsYmFjazogYW55KSA9PiB7XG4gICAgbGV0IHJlczogSFRUUFJlc3BvbnNlQm9keTtcbiAgICBjb25zdCBwYXJhbXMgPSBKU09OLnBhcnNlKGJvZHkpIGFzIFN0YXJ0VHJhbnNjcmliZVJlcXVlc3Q7XG4gICAgY29uc3QgbWVldGluZ05hbWUgPSBwYXRoUGFyYW1zW1wibWVldGluZ05hbWVcIl07XG4gICAgY29uc3QgYXR0ZW5kZWVJZCA9IHBhdGhQYXJhbXNbXCJhdHRlbmRlZUlkXCJdO1xuICAgIC8vLy8gKDEpIElmIHRoZXJlIGlzIG5vIG1lZXRpbmcsIHJldHVybiBmYWlcbiAgICBsZXQgZW1haWwgPSBcIlwiO1xuICAgIHRyeSB7XG4gICAgICAgIGVtYWlsID0gKGF3YWl0IGdldEVtYWlsRnJvbUFjY2Vzc1Rva2VuKGFjY2Vzc1Rva2VuKSkgfHwgXCJcIjtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHJlcyA9IHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgY29kZTogQ29kZXMuTk9fU1VDSF9BTl9BVFRFTkRFRSxcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBnZW5lcmF0ZVJlc3BvbnNlKHJlcyk7XG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3BvbnNlKTtcbiAgICB9XG4gICAgLy8vICgyKVxuICAgIHN0YXJ0VHJhbnNjcmliZSh7XG4gICAgICAgIGVtYWlsLFxuICAgICAgICBtZWV0aW5nTmFtZSxcbiAgICAgICAgbGFuZzogcGFyYW1zLmxhbmcsXG4gICAgfSk7XG4gICAgcmVzID0ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBjb2RlOiBDb2Rlcy5TVUNDRVNTLFxuICAgIH07XG4gICAgY29uc3QgcmVzcG9uc2UgPSBnZW5lcmF0ZVJlc3BvbnNlKHJlcyk7XG4gICAgY2FsbGJhY2sobnVsbCwgcmVzcG9uc2UpO1xufTtcbi8vLy8gKDUtMikgc3RvcCB0cmFuc2NyaWJlXG5jb25zdCBoYW5kbGVQb3N0U3RvcFRyYW5zY3JpYmUgPSBhc3luYyAoYWNjZXNzVG9rZW46IHN0cmluZywgcGF0aFBhcmFtczogeyBba2V5OiBzdHJpbmddOiBzdHJpbmcgfSwgYm9keTogYW55LCBjYWxsYmFjazogYW55KSA9PiB7XG4gICAgbGV0IHJlczogSFRUUFJlc3BvbnNlQm9keTtcbiAgICBjb25zdCBwYXJhbXMgPSBKU09OLnBhcnNlKGJvZHkpIGFzIFN0b3BUcmFuc2NyaWJlUmVxdWVzdDtcbiAgICBjb25zdCBtZWV0aW5nTmFtZSA9IHBhdGhQYXJhbXNbXCJtZWV0aW5nTmFtZVwiXTtcbiAgICBjb25zdCBhdHRlbmRlZUlkID0gcGF0aFBhcmFtc1tcImF0dGVuZGVlSWRcIl07XG4gICAgLy8vLyAoMSkgSWYgdGhlcmUgaXMgbm8gbWVldGluZywgcmV0dXJuIGZhaVxuICAgIGxldCBlbWFpbCA9IFwiXCI7XG4gICAgdHJ5IHtcbiAgICAgICAgZW1haWwgPSAoYXdhaXQgZ2V0RW1haWxGcm9tQWNjZXNzVG9rZW4oYWNjZXNzVG9rZW4pKSB8fCBcIlwiO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgcmVzID0ge1xuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICBjb2RlOiBDb2Rlcy5OT19TVUNIX0FOX0FUVEVOREVFLFxuICAgICAgICB9O1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IGdlbmVyYXRlUmVzcG9uc2UocmVzKTtcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzcG9uc2UpO1xuICAgIH1cbiAgICAvLy8gKDIpXG4gICAgc3RvcFRyYW5zY3JpYmUoe1xuICAgICAgICBlbWFpbCxcbiAgICAgICAgbWVldGluZ05hbWUsXG4gICAgfSk7XG4gICAgcmVzID0ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBjb2RlOiBDb2Rlcy5TVUNDRVNTLFxuICAgIH07XG4gICAgY29uc3QgcmVzcG9uc2UgPSBnZW5lcmF0ZVJlc3BvbnNlKHJlcyk7XG4gICAgY2FsbGJhY2sobnVsbCwgcmVzcG9uc2UpO1xufTtcbiJdfQ==