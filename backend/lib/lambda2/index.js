"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.handler = void 0;
const aws_sdk_1 = require("aws-sdk");
const const_1 = require("./const");
const meeting_1 = require("./meeting");
const util_1 = require("./util");
var meetingTableName = process.env.MEETING_TABLE_NAME;
var attendeesTableName = process.env.ATTENDEE_TABLE_NAME;
var ddb = new aws_sdk_1.DynamoDB();
const Methods = {
    GET: "GET",
    POST: "POST",
    DELETE: "DELETE",
};
const Resources = {
    Root: "/",
    Meetings: "/meetings",
    Meeting: "/meetings/{meetingName}",
    Attendees: "/meetings/{meetingName}/attendees",
    Attendee: "/meetings/{meetingName}/attendees/{attendeeId}",
    Operation: "/meetings/{meetingName}/attendees/{attendeeId}/operations/{operation}",
};
const Operations = {
    StartTranscribe: "start-transcribe",
    StopTranscribe: "stop-transcribe",
};
const Codes = {
    SUCCESS: "SUCCESS",
    UNKNOWN_RESOURCE: "UNKNOWN_RESOURCE",
    UNKNOWN_METHOD: "UNKNOWN_METHOD",
    TOKEN_ERROR: "TOKEN_ERROR",
    PARAMETER_ERROR: "PARAMETER_ERROR",
    NO_SUCH_A_MEETING_ROOM: "NO_SUCH_A_MEETING_ROOM",
    NO_SUCH_AN_ATTENDEE: "NO_SUCH_AN_ATTENDEE",
};
const handler = (event, context, callback) => {
    console.log(event);
    console.log("resource:", event.resource);
    console.log("pathPArameters:", event.pathParameters);
    console.log("method", event.httpMethod);
    console.log("body", event.body);
    const resource = event.resource;
    const pathParams = event.pathParameters;
    const method = event.httpMethod;
    const body = event.body;
    const accessToken = event.headers["x-flect-access-token"];
    console.log("pathParams", pathParams);
    switch (resource) {
        case Resources.Root:
            handleRoot(accessToken, method, pathParams, body, callback);
            break;
        case Resources.Meetings:
            handleMeetings(accessToken, method, pathParams, body, callback);
            break;
        case Resources.Meeting:
            handleMeeting(accessToken, method, pathParams, body, callback);
            break;
        case Resources.Attendees:
            handleAttendees(accessToken, method, pathParams, body, callback);
            break;
        case Resources.Attendee:
            handleAttendee(accessToken, method, pathParams, body, callback);
            break;
        case Resources.Operation:
            handleOperation(accessToken, method, pathParams, body, callback);
            break;
        default:
            console.log(`Unknwon resource name: ${resource}`);
            const response = (0, util_1.generateResponse)({ success: false, code: Codes.UNKNOWN_RESOURCE });
            callback(null, response);
    }
};
exports.handler = handler;
// (0) Root
const handleRoot = (accessToken, method, pathParams, body, callback) => {
    console.log(`HANDLE ROOT: ${method} ${body}`);
    const response = (0, util_1.generateResponse)({ success: true, code: Codes.SUCCESS });
    callback(null, response);
};
// (1) meetings
const handleMeetings = (accessToken, method, pathParams, body, callback) => {
    console.log(`HANDLE Meetings: ${method} ${body}`);
    switch (method) {
        case Methods.GET:
            handleGetMeetings(accessToken, pathParams, body, callback);
            break;
        case Methods.POST:
            handlePostMeetings(accessToken, pathParams, body, callback);
            break;
        default:
            console.log(`Unknwon method: ${method}`);
            const response = (0, util_1.generateResponse)({ success: false, code: Codes.UNKNOWN_METHOD });
            callback(null, response);
            break;
    }
};
//// (1-1) get meetings
const handleGetMeetings = (accessToken, pathParams, body, callback) => {
    ////// Not implemented
    const response = (0, util_1.generateResponse)({ success: true, code: Codes.SUCCESS });
    callback(null, response);
};
//// (1-2) post meetings
const handlePostMeetings = async (accessToken, pathParams, body, callback) => {
    const params = JSON.parse(body);
    let email;
    try {
        email = await (0, util_1.getEmailFromAccessToken)(accessToken);
    }
    catch (e) {
        console.log(e);
    }
    let res;
    if (email) {
        const result = await (0, meeting_1.createMeeting)(email, params.meetingName, params.region);
        res = {
            success: true,
            code: Codes.SUCCESS,
            data: result,
        };
    }
    else {
        res = {
            success: false,
            code: Codes.TOKEN_ERROR,
        };
    }
    const response = (0, util_1.generateResponse)(res);
    callback(null, response);
};
// (2) meetings
const handleMeeting = (accessToken, method, pathParams, body, callback) => {
    console.log(`HANDLE Meeting: ${method} ${body}`);
    switch (method) {
        case Methods.GET:
            handleGetMeeting(accessToken, pathParams, body, callback);
            break;
        case Methods.DELETE:
            handleDeleteMeeting(accessToken, pathParams, body, callback);
            break;
        default:
            console.log(`Unknwon method: ${method}`);
            const response = (0, util_1.generateResponse)({ success: false, code: Codes.UNKNOWN_METHOD });
            callback(null, response);
            break;
    }
};
//// (2-1) Get Meeting
const handleGetMeeting = async (accessToken, pathParams, body, callback) => {
    let res;
    const meetingName = pathParams["meetingName"];
    if (!meetingName) {
        console.log(`parameter error: ${meetingName}`);
        res = {
            success: false,
            code: Codes.PARAMETER_ERROR,
        };
    }
    else {
        const result = await (0, meeting_1.getMeetingInfo)(meetingName);
        if (!result) {
            res = {
                success: false,
                code: Codes.NO_SUCH_A_MEETING_ROOM,
            };
        }
        else {
            res = {
                success: true,
                code: Codes.SUCCESS,
                data: result,
            };
        }
    }
    const response = (0, util_1.generateResponse)(res);
    callback(null, response);
};
//// (2-2) Delete Meeting
const handleDeleteMeeting = async (accessToken, pathParams, body, callback) => {
    let res;
    const meetingName = pathParams["meetingName"];
    if (!meetingName) {
        console.log(`parameter error: ${meetingName}`);
        res = {
            success: false,
            code: Codes.PARAMETER_ERROR,
        };
    }
    else {
        await (0, meeting_1.deleteMeeting)(meetingName);
        res = {
            success: true,
            code: Codes.SUCCESS,
        };
    }
    const response = (0, util_1.generateResponse)(res);
    callback(null, response);
};
// (3) attendees
const handleAttendees = (accessToken, method, pathParams, body, callback) => {
    console.log(`HANDLE attendees: ${method} ${body}`);
    switch (method) {
        case Methods.GET:
            handleGetAttendees(accessToken, pathParams, body, callback);
            break;
        case Methods.POST:
            handlePostAttendees(accessToken, pathParams, body, callback);
            break;
        default:
            console.log(`Unknwon method: ${method}`);
            const response = (0, util_1.generateResponse)({ success: false, code: Codes.UNKNOWN_METHOD });
            callback(null, response);
            break;
    }
};
//// (3-1) Get Attendees
const handleGetAttendees = async (accessToken, pathParams, body, callback) => {
    // let res: ResponseBody;
    // const response = generateResponse(res);
    // callback(null, response);
};
//// (3-2) Post Attendees
const handlePostAttendees = async (accessToken, pathParams, body, callback) => {
    let res;
    const params = JSON.parse(body);
    const joinInfo = await (0, meeting_1.joinMeeting)(params.meetingName, params.attendeeName);
    if ("exception" in joinInfo) {
        const exception = joinInfo;
        if (exception.code === const_1.JoinMeetingExceptionType.NO_MEETING_FOUND) {
            res = {
                success: false,
                code: Codes.NO_SUCH_A_MEETING_ROOM,
            };
        }
        else {
            res = {
                success: false,
                code: Codes.PARAMETER_ERROR,
            };
        }
    }
    else {
        res = {
            success: true,
            code: Codes.SUCCESS,
            data: joinInfo,
        };
    }
    const response = (0, util_1.generateResponse)(res);
    callback(null, response);
};
// (4) attendees
const handleAttendee = (accessToken, method, pathParams, body, callback) => {
    console.log(`HANDLE attendee: ${method} ${body}`);
    switch (method) {
        case Methods.GET:
            handleGetAttendee(accessToken, pathParams, body, callback);
            break;
        default:
            console.log(`Unknwon method: ${method}`);
            const response = (0, util_1.generateResponse)({ success: false, code: Codes.UNKNOWN_METHOD });
            callback(null, response);
            break;
    }
};
//// (4-1) Get Attendee
const handleGetAttendee = async (accessToken, pathParams, body, callback) => {
    let res;
    const meetingName = pathParams["meetingName"];
    const attendeeId = pathParams["attendeeId"];
    if (!meetingName || !attendeeId) {
        console.log(`parameter error: ${meetingName}, ${attendeeId}`);
        res = {
            success: false,
            code: Codes.PARAMETER_ERROR,
        };
    }
    else {
        const attendeeInfo = await (0, meeting_1.getAttendeeInfo)(meetingName, attendeeId);
        if ("exception" in attendeeInfo) {
            const exception = attendeeInfo;
            if (exception.code === const_1.GetAttendeeInfoExceptionType.NO_ATTENDEE_FOUND) {
                res = {
                    success: false,
                    code: Codes.NO_SUCH_AN_ATTENDEE,
                };
            }
            else {
                res = {
                    success: false,
                    code: Codes.PARAMETER_ERROR,
                };
            }
        }
        else {
            res = {
                success: true,
                code: Codes.SUCCESS,
                data: attendeeInfo,
            };
        }
    }
    const response = (0, util_1.generateResponse)(res);
    callback(null, response);
};
// (5) Operation
const handleOperation = (accessToken, method, pathParams, body, callback) => {
    console.log(`HANDLE operation: ${method} ${body}`);
    const meetingName = pathParams["meetingName"];
    const attendeeId = pathParams["attendeeId"];
    const operation = pathParams["operation"];
    switch (method) {
        case Methods.POST:
            if (operation === Operations.StartTranscribe) {
                handlePostStartTranscribe(accessToken, pathParams, body, callback);
            }
            else if (operation === Operations.StopTranscribe) {
                handlePostStopTranscribe(accessToken, pathParams, body, callback);
            }
            break;
        default:
            console.log(`Unknwon method: ${method}`);
            const response = (0, util_1.generateResponse)({ success: false, code: Codes.UNKNOWN_METHOD });
            callback(null, response);
            break;
    }
};
//// (5-1) start transcribe
const handlePostStartTranscribe = async (accessToken, pathParams, body, callback) => {
    let res;
    const params = JSON.parse(body);
    const meetingName = pathParams["meetingName"];
    const attendeeId = pathParams["attendeeId"];
    //// (1) If there is no meeting, return fai
    let email = "";
    try {
        email = (await (0, util_1.getEmailFromAccessToken)(accessToken)) || "";
    }
    catch (e) {
        res = {
            success: false,
            code: Codes.NO_SUCH_AN_ATTENDEE,
        };
        const response = (0, util_1.generateResponse)(res);
        callback(null, response);
    }
    /// (2)
    (0, meeting_1.startTranscribe)(email, meetingName, params.lang);
    res = {
        success: true,
        code: Codes.SUCCESS,
    };
    const response = (0, util_1.generateResponse)(res);
    callback(null, response);
};
//// (5-2) stop transcribe
const handlePostStopTranscribe = async (accessToken, pathParams, body, callback) => {
    let res;
    const params = JSON.parse(body);
    const meetingName = pathParams["meetingName"];
    const attendeeId = pathParams["attendeeId"];
    //// (1) If there is no meeting, return fai
    let email = "";
    try {
        email = (await (0, util_1.getEmailFromAccessToken)(accessToken)) || "";
    }
    catch (e) {
        res = {
            success: false,
            code: Codes.NO_SUCH_AN_ATTENDEE,
        };
        const response = (0, util_1.generateResponse)(res);
        callback(null, response);
    }
    /// (2)
    (0, meeting_1.stopTranscribe)(email, meetingName);
    res = {
        success: true,
        code: Codes.SUCCESS,
    };
    const response = (0, util_1.generateResponse)(res);
    callback(null, response);
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSxxQ0FBbUM7QUFDbkMsbUNBQXdPO0FBQ3hPLHVDQUF3STtBQUN4SSxpQ0FBbUU7QUFFbkUsSUFBSSxnQkFBZ0IsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLGtCQUFtQixDQUFDO0FBQ3ZELElBQUksa0JBQWtCLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxtQkFBb0IsQ0FBQztBQUMxRCxJQUFJLEdBQUcsR0FBRyxJQUFJLGtCQUFRLEVBQUUsQ0FBQztBQUV6QixNQUFNLE9BQU8sR0FBRztJQUNaLEdBQUcsRUFBRSxLQUFLO0lBQ1YsSUFBSSxFQUFFLE1BQU07SUFDWixNQUFNLEVBQUUsUUFBUTtDQUNWLENBQUM7QUFHWCxNQUFNLFNBQVMsR0FBRztJQUNkLElBQUksRUFBRSxHQUFHO0lBQ1QsUUFBUSxFQUFFLFdBQVc7SUFDckIsT0FBTyxFQUFFLHlCQUF5QjtJQUNsQyxTQUFTLEVBQUUsbUNBQW1DO0lBQzlDLFFBQVEsRUFBRSxnREFBZ0Q7SUFDMUQsU0FBUyxFQUFFLHVFQUF1RTtDQUM1RSxDQUFDO0FBR1gsTUFBTSxVQUFVLEdBQUc7SUFDZixlQUFlLEVBQUUsa0JBQWtCO0lBQ25DLGNBQWMsRUFBRSxpQkFBaUI7Q0FDM0IsQ0FBQztBQUdYLE1BQU0sS0FBSyxHQUFHO0lBQ1YsT0FBTyxFQUFFLFNBQVM7SUFDbEIsZ0JBQWdCLEVBQUUsa0JBQWtCO0lBQ3BDLGNBQWMsRUFBRSxnQkFBZ0I7SUFDaEMsV0FBVyxFQUFFLGFBQWE7SUFDMUIsZUFBZSxFQUFFLGlCQUFpQjtJQUNsQyxzQkFBc0IsRUFBRSx3QkFBd0I7SUFDaEQsbUJBQW1CLEVBQUUscUJBQXFCO0NBQ3BDLENBQUM7QUFHSixNQUFNLE9BQU8sR0FBRyxDQUFDLEtBQVUsRUFBRSxPQUFZLEVBQUUsUUFBYSxFQUFFLEVBQUU7SUFDL0QsT0FBTyxDQUFDLEdB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IGZyb20gXCJhd3Mtc2RrXCI7XG5pbXBvcnQgeyBDcmVhdGVNZWV0aW5nUmVxdWVzdCwgSm9pbk1lZXRpbmdSZXF1ZXN0LCBSZXNwb25zZUJvZHksIEpvaW5NZWV0aW5nRXhjZXB0aW9uLCBKb2luTWVldGluZ0V4Y2VwdGlvblR5cGUsIEdldEF0dGVuZGVlSW5mb0V4Y2VwdGlvbiwgR2V0QXR0ZW5kZWVJbmZvRXhjZXB0aW9uVHlwZSwgU3RhcnRUcmFuc2NyaWJlUmVxdWVzdCwgU3RvcFRyYW5zY3JpYmVSZXF1ZXN0IH0gZnJvbSBcIi4vY29uc3RcIjtcbmltcG9ydCB7IGNyZWF0ZU1lZXRpbmcsIGRlbGV0ZU1lZXRpbmcsIGdldEF0dGVuZGVlSW5mbywgZ2V0TWVldGluZ0luZm8sIGpvaW5NZWV0aW5nLCBzdGFydFRyYW5zY3JpYmUsIHN0b3BUcmFuc2NyaWJlIH0gZnJvbSBcIi4vbWVldGluZ1wiO1xuaW1wb3J0IHsgZ2VuZXJhdGVSZXNwb25zZSwgZ2V0RW1haWxGcm9tQWNjZXNzVG9rZW4gfSBmcm9tIFwiLi91dGlsXCI7XG5cbnZhciBtZWV0aW5nVGFibGVOYW1lID0gcHJvY2Vzcy5lbnYuTUVFVElOR19UQUJMRV9OQU1FITtcbnZhciBhdHRlbmRlZXNUYWJsZU5hbWUgPSBwcm9jZXNzLmVudi5BVFRFTkRFRV9UQUJMRV9OQU1FITtcbnZhciBkZGIgPSBuZXcgRHluYW1vREIoKTtcblxuY29uc3QgTWV0aG9kcyA9IHtcbiAgICBHRVQ6IFwiR0VUXCIsXG4gICAgUE9TVDogXCJQT1NUXCIsXG4gICAgREVMRVRFOiBcIkRFTEVURVwiLFxufSBhcyBjb25zdDtcbnR5cGUgTWV0aG9kcyA9IHR5cGVvZiBNZXRob2RzW2tleW9mIHR5cGVvZiBNZXRob2RzXTtcblxuY29uc3QgUmVzb3VyY2VzID0ge1xuICAgIFJvb3Q6IFwiL1wiLFxuICAgIE1lZXRpbmdzOiBcIi9tZWV0aW5nc1wiLFxuICAgIE1lZXRpbmc6IFwiL21lZXRpbmdzL3ttZWV0aW5nTmFtZX1cIixcbiAgICBBdHRlbmRlZXM6IFwiL21lZXRpbmdzL3ttZWV0aW5nTmFtZX0vYXR0ZW5kZWVzXCIsXG4gICAgQXR0ZW5kZWU6IFwiL21lZXRpbmdzL3ttZWV0aW5nTmFtZX0vYXR0ZW5kZWVzL3thdHRlbmRlZUlkfVwiLFxuICAgIE9wZXJhdGlvbjogXCIvbWVldGluZ3Mve21lZXRpbmdOYW1lfS9hdHRlbmRlZXMve2F0dGVuZGVlSWR9L29wZXJhdGlvbnMve29wZXJhdGlvbn1cIixcbn0gYXMgY29uc3Q7XG50eXBlIFJlc291cmNlcyA9IHR5cGVvZiBSZXNvdXJjZXNba2V5b2YgdHlwZW9mIFJlc291cmNlc107XG5cbmNvbnN0IE9wZXJhdGlvbnMgPSB7XG4gICAgU3RhcnRUcmFuc2NyaWJlOiBcInN0YXJ0LXRyYW5zY3JpYmVcIixcbiAgICBTdG9wVHJhbnNjcmliZTogXCJzdG9wLXRyYW5zY3JpYmVcIixcbn0gYXMgY29uc3Q7XG50eXBlIE9wZXJhdGlvbnMgPSB0eXBlb2YgT3BlcmF0aW9uc1trZXlvZiB0eXBlb2YgT3BlcmF0aW9uc107XG5cbmNvbnN0IENvZGVzID0ge1xuICAgIFNVQ0NFU1M6IFwiU1VDQ0VTU1wiLFxuICAgIFVOS05PV05fUkVTT1VSQ0U6IFwiVU5LTk9XTl9SRVNPVVJDRVwiLFxuICAgIFVOS05PV05fTUVUSE9EOiBcIlVOS05PV05fTUVUSE9EXCIsXG4gICAgVE9LRU5fRVJST1I6IFwiVE9LRU5fRVJST1JcIixcbiAgICBQQVJBTUVURVJfRVJST1I6IFwiUEFSQU1FVEVSX0VSUk9SXCIsXG4gICAgTk9fU1VDSF9BX01FRVRJTkdfUk9PTTogXCJOT19TVUNIX0FfTUVFVElOR19ST09NXCIsXG4gICAgTk9fU1VDSF9BTl9BVFRFTkRFRTogXCJOT19TVUNIX0FOX0FUVEVOREVFXCIsXG59IGFzIGNvbnN0O1xudHlwZSBDb2RlID0gdHlwZW9mIENvZGVzW2tleW9mIHR5cGVvZiBDb2Rlc107XG5cbmV4cG9ydCBjb25zdCBoYW5kbGVyID0gKGV2ZW50OiBhbnksIGNvbnRleHQ6IGFueSwgY2FsbGJhY2s6IGFueSkgPT4ge1xuICAgIGNvbnNvbGUubG9nKGV2ZW50KTtcbiAgICBjb25zb2xlLmxvZyhcInJlc291cmNlOlwiLCBldmVudC5yZXNvdXJjZSk7XG4gICAgY29uc29sZS5sb2coXCJwYXRoUEFyYW1ldGVyczpcIiwgZXZlbnQucGF0aFBhcmFtZXRlcnMpO1xuICAgIGNvbnNvbGUubG9nKFwibWV0aG9kXCIsIGV2ZW50Lmh0dHBNZXRob2QpO1xuICAgIGNvbnNvbGUubG9nKFwiYm9keVwiLCBldmVudC5ib2R5KTtcblxuICAgIGNvbnN0IHJlc291cmNlID0gZXZlbnQucmVzb3VyY2U7XG4gICAgY29uc3QgcGF0aFBhcmFtcyA9IGV2ZW50LnBhdGhQYXJhbWV0ZXJzO1xuICAgIGNvbnN0IG1ldGhvZCA9IGV2ZW50Lmh0dHBNZXRob2Q7XG4gICAgY29uc3QgYm9keSA9IGV2ZW50LmJvZHk7XG4gICAgY29uc3QgYWNjZXNzVG9rZW4gPSBldmVudC5oZWFkZXJzW1wieC1mbGVjdC1hY2Nlc3MtdG9rZW5cIl07XG5cbiAgICBjb25zb2xlLmxvZyhcInBhdGhQYXJhbXNcIiwgcGF0aFBhcmFtcyk7XG5cbiAgICBzd2l0Y2ggKHJlc291cmNlKSB7XG4gICAgICAgIGNhc2UgUmVzb3VyY2VzLlJvb3Q6XG4gICAgICAgICAgICBoYW5kbGVSb290KGFjY2Vzc1Rva2VuLCBtZXRob2QsIHBhdGhQYXJhbXMsIGJvZHksIGNhbGxiYWNrKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFJlc291cmNlcy5NZWV0aW5nczpcbiAgICAgICAgICAgIGhhbmRsZU1lZXRpbmdzKGFjY2Vzc1Rva2VuLCBtZXRob2QsIHBhdGhQYXJhbXMsIGJvZHksIGNhbGxiYWNrKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFJlc291cmNlcy5NZWV0aW5nOlxuICAgICAgICAgICAgaGFuZGxlTWVldGluZyhhY2Nlc3NUb2tlbiwgbWV0aG9kLCBwYXRoUGFyYW1zLCBib2R5LCBjYWxsYmFjayk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBSZXNvdXJjZXMuQXR0ZW5kZWVzOlxuICAgICAgICAgICAgaGFuZGxlQXR0ZW5kZWVzKGFjY2Vzc1Rva2VuLCBtZXRob2QsIHBhdGhQYXJhbXMsIGJvZHksIGNhbGxiYWNrKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFJlc291cmNlcy5BdHRlbmRlZTpcbiAgICAgICAgICAgIGhhbmRsZUF0dGVuZGVlKGFjY2Vzc1Rva2VuLCBtZXRob2QsIHBhdGhQYXJhbXMsIGJvZHksIGNhbGxiYWNrKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFJlc291cmNlcy5PcGVyYXRpb246XG4gICAgICAgICAgICBoYW5kbGVPcGVyYXRpb24oYWNjZXNzVG9rZW4sIG1ldGhvZCwgcGF0aFBhcmFtcywgYm9keSwgY2FsbGJhY2spO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgVW5rbndvbiByZXNvdXJjZSBuYW1lOiAke3Jlc291cmNlfWApO1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBnZW5lcmF0ZVJlc3BvbnNlKHsgc3VjY2VzczogZmFsc2UsIGNvZGU6IENvZGVzLlVOS05PV05fUkVTT1VSQ0UgfSk7XG4gICAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXNwb25zZSk7XG4gICAgfVxufTtcblxuLy8gKDApIFJvb3RcbmNvbnN0IGhhbmRsZVJvb3QgPSAoYWNjZXNzVG9rZW46IHN0cmluZywgbWV0aG9kOiBzdHJpbmcsIHBhdGhQYXJhbXM6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0sIGJvZHk6IGFueSwgY2FsbGJhY2s6IGFueSkgPT4ge1xuICAgIGNvbnNvbGUubG9nKGBIQU5ETEUgUk9PVDogJHttZXRob2R9ICR7Ym9keX1gKTtcbiAgICBjb25zdCByZXNwb25zZSA9IGdlbmVyYXRlUmVzcG9uc2UoeyBzdWNjZXNzOiB0cnVlLCBjb2RlOiBDb2Rlcy5TVUNDRVNTIH0pO1xuICAgIGNhbGxiYWNrKG51bGwsIHJlc3BvbnNlKTtcbn07XG5cbi8vICgxKSBtZWV0aW5nc1xuY29uc3QgaGFuZGxlTWVldGluZ3MgPSAoYWNjZXNzVG9rZW46IHN0cmluZywgbWV0aG9kOiBzdHJpbmcsIHBhdGhQYXJhbXM6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0sIGJvZHk6IGFueSwgY2FsbGJhY2s6IGFueSkgPT4ge1xuICAgIGNvbnNvbGUubG9nKGBIQU5ETEUgTWVldGluZ3M6ICR7bWV0aG9kfSAke2JvZHl9YCk7XG4gICAgc3dpdGNoIChtZXRob2QpIHtcbiAgICAgICAgY2FzZSBNZXRob2RzLkdFVDpcbiAgICAgICAgICAgIGhhbmRsZUdldE1lZXRpbmdzKGFjY2Vzc1Rva2VuLCBwYXRoUGFyYW1zLCBib2R5LCBjYWxsYmFjayk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBNZXRob2RzLlBPU1Q6XG4gICAgICAgICAgICBoYW5kbGVQb3N0TWVldGluZ3MoYWNjZXNzVG9rZW4sIHBhdGhQYXJhbXMsIGJvZHksIGNhbGxiYWNrKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgY29uc29sZS5sb2coYFVua253b24gbWV0aG9kOiAke21ldGhvZH1gKTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gZ2VuZXJhdGVSZXNwb25zZSh7IHN1Y2Nlc3M6IGZhbHNlLCBjb2RlOiBDb2Rlcy5VTktOT1dOX01FVEhPRCB9KTtcbiAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3BvbnNlKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgIH1cbn07XG4vLy8vICgxLTEpIGdldCBtZWV0aW5nc1xuY29uc3QgaGFuZGxlR2V0TWVldGluZ3MgPSAoYWNjZXNzVG9rZW46IHN0cmluZywgcGF0aFBhcmFtczogeyBba2V5OiBzdHJpbmddOiBzdHJpbmcgfSwgYm9keTogYW55LCBjYWxsYmFjazogYW55KSA9PiB7XG4gICAgLy8vLy8vIE5vdCBpbXBsZW1lbnRlZFxuICAgIGNvbnN0IHJlc3BvbnNlID0gZ2VuZXJhdGVSZXNwb25zZSh7IHN1Y2Nlc3M6IHRydWUsIGNvZGU6IENvZGVzLlNVQ0NFU1MgfSk7XG4gICAgY2FsbGJhY2sobnVsbCwgcmVzcG9uc2UpO1xufTtcbi8vLy8gKDEtMikgcG9zdCBtZWV0aW5nc1xuY29uc3QgaGFuZGxlUG9zdE1lZXRpbmdzID0gYXN5bmMgKGFjY2Vzc1Rva2VuOiBzdHJpbmcsIHBhdGhQYXJhbXM6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0sIGJvZHk6IGFueSwgY2FsbGJhY2s6IGFueSkgPT4ge1xuICAgIGNvbnN0IHBhcmFtcyA9IEpTT04ucGFyc2UoYm9keSkgYXMgQ3JlYXRlTWVldGluZ1JlcXVlc3Q7XG4gICAgbGV0IGVtYWlsO1xuICAgIHRyeSB7XG4gICAgICAgIGVtYWlsID0gYXdhaXQgZ2V0RW1haWxGcm9tQWNjZXNzVG9rZW4oYWNjZXNzVG9rZW4pO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgY29uc29sZS5sb2coZSk7XG4gICAgfVxuICAgIGxldCByZXM6IFJlc3BvbnNlQm9keTtcbiAgICBpZiAoZW1haWwpIHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY3JlYXRlTWVldGluZyhlbWFpbCwgcGFyYW1zLm1lZXRpbmdOYW1lLCBwYXJhbXMucmVnaW9uKTtcbiAgICAgICAgcmVzID0ge1xuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgIGNvZGU6IENvZGVzLlNVQ0NFU1MsXG4gICAgICAgICAgICBkYXRhOiByZXN1bHQsXG4gICAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgICAgcmVzID0ge1xuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICBjb2RlOiBDb2Rlcy5UT0tFTl9FUlJPUixcbiAgICAgICAgfTtcbiAgICB9XG4gICAgY29uc3QgcmVzcG9uc2UgPSBnZW5lcmF0ZVJlc3BvbnNlKHJlcyk7XG4gICAgY2FsbGJhY2sobnVsbCwgcmVzcG9uc2UpO1xufTtcbi8vICgyKSBtZWV0aW5nc1xuY29uc3QgaGFuZGxlTWVldGluZyA9IChhY2Nlc3NUb2tlbjogc3RyaW5nLCBtZXRob2Q6IHN0cmluZywgcGF0aFBhcmFtczogeyBba2V5OiBzdHJpbmddOiBzdHJpbmcgfSwgYm9keTogYW55LCBjYWxsYmFjazogYW55KSA9PiB7XG4gICAgY29uc29sZS5sb2coYEhBTkRMRSBNZWV0aW5nOiAke21ldGhvZH0gJHtib2R5fWApO1xuICAgIHN3aXRjaCAobWV0aG9kKSB7XG4gICAgICAgIGNhc2UgTWV0aG9kcy5HRVQ6XG4gICAgICAgICAgICBoYW5kbGVHZXRNZWV0aW5nKGFjY2Vzc1Rva2VuLCBwYXRoUGFyYW1zLCBib2R5LCBjYWxsYmFjayk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBNZXRob2RzLkRFTEVURTpcbiAgICAgICAgICAgIGhhbmRsZURlbGV0ZU1lZXRpbmcoYWNjZXNzVG9rZW4sIHBhdGhQYXJhbXMsIGJvZHksIGNhbGxiYWNrKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgY29uc29sZS5sb2coYFVua253b24gbWV0aG9kOiAke21ldGhvZH1gKTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gZ2VuZXJhdGVSZXNwb25zZSh7IHN1Y2Nlc3M6IGZhbHNlLCBjb2RlOiBDb2Rlcy5VTktOT1dOX01FVEhPRCB9KTtcbiAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3BvbnNlKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgIH1cbn07XG4vLy8vICgyLTEpIEdldCBNZWV0aW5nXG5jb25zdCBoYW5kbGVHZXRNZWV0aW5nID0gYXN5bmMgKGFjY2Vzc1Rva2VuOiBzdHJpbmcsIHBhdGhQYXJhbXM6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0sIGJvZHk6IGFueSwgY2FsbGJhY2s6IGFueSkgPT4ge1xuICAgIGxldCByZXM6IFJlc3BvbnNlQm9keTtcbiAgICBjb25zdCBtZWV0aW5nTmFtZSA9IHBhdGhQYXJhbXNbXCJtZWV0aW5nTmFtZVwiXTtcbiAgICBpZiAoIW1lZXRpbmdOYW1lKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGBwYXJhbWV0ZXIgZXJyb3I6ICR7bWVldGluZ05hbWV9YCk7XG4gICAgICAgIHJlcyA9IHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgY29kZTogQ29kZXMuUEFSQU1FVEVSX0VSUk9SLFxuICAgICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGdldE1lZXRpbmdJbmZvKG1lZXRpbmdOYW1lKTtcbiAgICAgICAgaWYgKCFyZXN1bHQpIHtcbiAgICAgICAgICAgIHJlcyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBjb2RlOiBDb2Rlcy5OT19TVUNIX0FfTUVFVElOR19ST09NLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlcyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgICAgIGNvZGU6IENvZGVzLlNVQ0NFU1MsXG4gICAgICAgICAgICAgICAgZGF0YTogcmVzdWx0LFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb25zdCByZXNwb25zZSA9IGdlbmVyYXRlUmVzcG9uc2UocmVzKTtcbiAgICBjYWxsYmFjayhudWxsLCByZXNwb25zZSk7XG59O1xuXG4vLy8vICgyLTIpIERlbGV0ZSBNZWV0aW5nXG5jb25zdCBoYW5kbGVEZWxldGVNZWV0aW5nID0gYXN5bmMgKGFjY2Vzc1Rva2VuOiBzdHJpbmcsIHBhdGhQYXJhbXM6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0sIGJvZHk6IGFueSwgY2FsbGJhY2s6IGFueSkgPT4ge1xuICAgIGxldCByZXM6IFJlc3BvbnNlQm9keTtcbiAgICBjb25zdCBtZWV0aW5nTmFtZSA9IHBhdGhQYXJhbXNbXCJtZWV0aW5nTmFtZVwiXTtcbiAgICBpZiAoIW1lZXRpbmdOYW1lKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGBwYXJhbWV0ZXIgZXJyb3I6ICR7bWVldGluZ05hbWV9YCk7XG4gICAgICAgIHJlcyA9IHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgY29kZTogQ29kZXMuUEFSQU1FVEVSX0VSUk9SLFxuICAgICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGF3YWl0IGRlbGV0ZU1lZXRpbmcobWVldGluZ05hbWUpO1xuICAgICAgICByZXMgPSB7XG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgY29kZTogQ29kZXMuU1VDQ0VTUyxcbiAgICAgICAgfTtcbiAgICB9XG4gICAgY29uc3QgcmVzcG9uc2UgPSBnZW5lcmF0ZVJlc3BvbnNlKHJlcyk7XG4gICAgY2FsbGJhY2sobnVsbCwgcmVzcG9uc2UpO1xufTtcblxuLy8gKDMpIGF0dGVuZGVlc1xuY29uc3QgaGFuZGxlQXR0ZW5kZWVzID0gKGFjY2Vzc1Rva2VuOiBzdHJpbmcsIG1ldGhvZDogc3RyaW5nLCBwYXRoUGFyYW1zOiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9LCBib2R5OiBhbnksIGNhbGxiYWNrOiBhbnkpID0+IHtcbiAgICBjb25zb2xlLmxvZyhgSEFORExFIGF0dGVuZGVlczogJHttZXRob2R9ICR7Ym9keX1gKTtcbiAgICBzd2l0Y2ggKG1ldGhvZCkge1xuICAgICAgICBjYXNlIE1ldGhvZHMuR0VUOlxuICAgICAgICAgICAgaGFuZGxlR2V0QXR0ZW5kZWVzKGFjY2Vzc1Rva2VuLCBwYXRoUGFyYW1zLCBib2R5LCBjYWxsYmFjayk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBNZXRob2RzLlBPU1Q6XG4gICAgICAgICAgICBoYW5kbGVQb3N0QXR0ZW5kZWVzKGFjY2Vzc1Rva2VuLCBwYXRoUGFyYW1zLCBib2R5LCBjYWxsYmFjayk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBVbmtud29uIG1ldGhvZDogJHttZXRob2R9YCk7XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGdlbmVyYXRlUmVzcG9uc2UoeyBzdWNjZXNzOiBmYWxzZSwgY29kZTogQ29kZXMuVU5LTk9XTl9NRVRIT0QgfSk7XG4gICAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXNwb25zZSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICB9XG59O1xuXG4vLy8vICgzLTEpIEdldCBBdHRlbmRlZXNcbmNvbnN0IGhhbmRsZUdldEF0dGVuZGVlcyA9IGFzeW5jIChhY2Nlc3NUb2tlbjogc3RyaW5nLCBwYXRoUGFyYW1zOiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9LCBib2R5OiBhbnksIGNhbGxiYWNrOiBhbnkpID0+IHtcbiAgICAvLyBsZXQgcmVzOiBSZXNwb25zZUJvZHk7XG4gICAgLy8gY29uc3QgcmVzcG9uc2UgPSBnZW5lcmF0ZVJlc3BvbnNlKHJlcyk7XG4gICAgLy8gY2FsbGJhY2sobnVsbCwgcmVzcG9uc2UpO1xufTtcbi8vLy8gKDMtMikgUG9zdCBBdHRlbmRlZXNcbmNvbnN0IGhhbmRsZVBvc3RBdHRlbmRlZXMgPSBhc3luYyAoYWNjZXNzVG9rZW46IHN0cmluZywgcGF0aFBhcmFtczogeyBba2V5OiBzdHJpbmddOiBzdHJpbmcgfSwgYm9keTogYW55LCBjYWxsYmFjazogYW55KSA9PiB7XG4gICAgbGV0IHJlczogUmVzcG9uc2VCb2R5O1xuICAgIGNvbnN0IHBhcmFtcyA9IEpTT04ucGFyc2UoYm9keSkgYXMgSm9pbk1lZXRpbmdSZXF1ZXN0O1xuXG4gICAgY29uc3Qgam9pbkluZm8gPSBhd2FpdCBqb2luTWVldGluZyhwYXJhbXMubWVldGluZ05hbWUsIHBhcmFtcy5hdHRlbmRlZU5hbWUpO1xuICAgIGlmIChcImV4Y2VwdGlvblwiIGluIGpvaW5JbmZvKSB7XG4gICAgICAgIGNvbnN0IGV4Y2VwdGlvbiA9IGpvaW5JbmZvIGFzIEpvaW5NZWV0aW5nRXhjZXB0aW9uO1xuICAgICAgICBpZiAoZXhjZXB0aW9uLmNvZGUgPT09IEpvaW5NZWV0aW5nRXhjZXB0aW9uVHlwZS5OT19NRUVUSU5HX0ZPVU5EKSB7XG4gICAgICAgICAgICByZXMgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICAgICAgY29kZTogQ29kZXMuTk9fU1VDSF9BX01FRVRJTkdfUk9PTSxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXMgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICAgICAgY29kZTogQ29kZXMuUEFSQU1FVEVSX0VSUk9SLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAgIHJlcyA9IHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgICBjb2RlOiBDb2Rlcy5TVUNDRVNTLFxuICAgICAgICAgICAgZGF0YTogam9pbkluZm8sXG4gICAgICAgIH07XG4gICAgfVxuICAgIGNvbnN0IHJlc3BvbnNlID0gZ2VuZXJhdGVSZXNwb25zZShyZXMpO1xuICAgIGNhbGxiYWNrKG51bGwsIHJlc3BvbnNlKTtcbn07XG5cbi8vICg0KSBhdHRlbmRlZXNcbmNvbnN0IGhhbmRsZUF0dGVuZGVlID0gKGFjY2Vzc1Rva2VuOiBzdHJpbmcsIG1ldGhvZDogc3RyaW5nLCBwYXRoUGFyYW1zOiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9LCBib2R5OiBhbnksIGNhbGxiYWNrOiBhbnkpID0+IHtcbiAgICBjb25zb2xlLmxvZyhgSEFORExFIGF0dGVuZGVlOiAke21ldGhvZH0gJHtib2R5fWApO1xuICAgIHN3aXRjaCAobWV0aG9kKSB7XG4gICAgICAgIGNhc2UgTWV0aG9kcy5HRVQ6XG4gICAgICAgICAgICBoYW5kbGVHZXRBdHRlbmRlZShhY2Nlc3NUb2tlbiwgcGF0aFBhcmFtcywgYm9keSwgY2FsbGJhY2spO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgVW5rbndvbiBtZXRob2Q6ICR7bWV0aG9kfWApO1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBnZW5lcmF0ZVJlc3BvbnNlKHsgc3VjY2VzczogZmFsc2UsIGNvZGU6IENvZGVzLlVOS05PV05fTUVUSE9EIH0pO1xuICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzcG9uc2UpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgfVxufTtcblxuLy8vLyAoNC0xKSBHZXQgQXR0ZW5kZWVcbmNvbnN0IGhhbmRsZUdldEF0dGVuZGVlID0gYXN5bmMgKGFjY2Vzc1Rva2VuOiBzdHJpbmcsIHBhdGhQYXJhbXM6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0sIGJvZHk6IGFueSwgY2FsbGJhY2s6IGFueSkgPT4ge1xuICAgIGxldCByZXM6IFJlc3BvbnNlQm9keTtcbiAgICBjb25zdCBtZWV0aW5nTmFtZSA9IHBhdGhQYXJhbXNbXCJtZWV0aW5nTmFtZVwiXTtcbiAgICBjb25zdCBhdHRlbmRlZUlkID0gcGF0aFBhcmFtc1tcImF0dGVuZGVlSWRcIl07XG4gICAgaWYgKCFtZWV0aW5nTmFtZSB8fCAhYXR0ZW5kZWVJZCkge1xuICAgICAgICBjb25zb2xlLmxvZyhgcGFyYW1ldGVyIGVycm9yOiAke21lZXRpbmdOYW1lfSwgJHthdHRlbmRlZUlkfWApO1xuICAgICAgICByZXMgPSB7XG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgIGNvZGU6IENvZGVzLlBBUkFNRVRFUl9FUlJPUixcbiAgICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBhdHRlbmRlZUluZm8gPSBhd2FpdCBnZXRBdHRlbmRlZUluZm8obWVldGluZ05hbWUsIGF0dGVuZGVlSWQpO1xuXG4gICAgICAgIGlmIChcImV4Y2VwdGlvblwiIGluIGF0dGVuZGVlSW5mbykge1xuICAgICAgICAgICAgY29uc3QgZXhjZXB0aW9uID0gYXR0ZW5kZWVJbmZvIGFzIEdldEF0dGVuZGVlSW5mb0V4Y2VwdGlvbjtcbiAgICAgICAgICAgIGlmIChleGNlcHRpb24uY29kZSA9PT0gR2V0QXR0ZW5kZWVJbmZvRXhjZXB0aW9uVHlwZS5OT19BVFRFTkRFRV9GT1VORCkge1xuICAgICAgICAgICAgICAgIHJlcyA9IHtcbiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIGNvZGU6IENvZGVzLk5PX1NVQ0hfQU5fQVRURU5ERUUsXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVzID0ge1xuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgY29kZTogQ29kZXMuUEFSQU1FVEVSX0VSUk9SLFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXMgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgICAgICBjb2RlOiBDb2Rlcy5TVUNDRVNTLFxuICAgICAgICAgICAgICAgIGRhdGE6IGF0dGVuZGVlSW5mbyxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29uc3QgcmVzcG9uc2UgPSBnZW5lcmF0ZVJlc3BvbnNlKHJlcyk7XG4gICAgY2FsbGJhY2sobnVsbCwgcmVzcG9uc2UpO1xufTtcblxuLy8gKDUpIE9wZXJhdGlvblxuY29uc3QgaGFuZGxlT3BlcmF0aW9uID0gKGFjY2Vzc1Rva2VuOiBzdHJpbmcsIG1ldGhvZDogc3RyaW5nLCBwYXRoUGFyYW1zOiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9LCBib2R5OiBhbnksIGNhbGxiYWNrOiBhbnkpID0+IHtcbiAgICBjb25zb2xlLmxvZyhgSEFORExFIG9wZXJhdGlvbjogJHttZXRob2R9ICR7Ym9keX1gKTtcbiAgICBjb25zdCBtZWV0aW5nTmFtZSA9IHBhdGhQYXJhbXNbXCJtZWV0aW5nTmFtZVwiXTtcbiAgICBjb25zdCBhdHRlbmRlZUlkID0gcGF0aFBhcmFtc1tcImF0dGVuZGVlSWRcIl07XG4gICAgY29uc3Qgb3BlcmF0aW9uID0gcGF0aFBhcmFtc1tcIm9wZXJhdGlvblwiXTtcbiAgICBzd2l0Y2ggKG1ldGhvZCkge1xuICAgICAgICBjYXNlIE1ldGhvZHMuUE9TVDpcbiAgICAgICAgICAgIGlmIChvcGVyYXRpb24gPT09IE9wZXJhdGlvbnMuU3RhcnRUcmFuc2NyaWJlKSB7XG4gICAgICAgICAgICAgICAgaGFuZGxlUG9zdFN0YXJ0VHJhbnNjcmliZShhY2Nlc3NUb2tlbiwgcGF0aFBhcmFtcywgYm9keSwgY2FsbGJhY2spO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChvcGVyYXRpb24gPT09IE9wZXJhdGlvbnMuU3RvcFRyYW5zY3JpYmUpIHtcbiAgICAgICAgICAgICAgICBoYW5kbGVQb3N0U3RvcFRyYW5zY3JpYmUoYWNjZXNzVG9rZW4sIHBhdGhQYXJhbXMsIGJvZHksIGNhbGxiYWNrKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgY29uc29sZS5sb2coYFVua253b24gbWV0aG9kOiAke21ldGhvZH1gKTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gZ2VuZXJhdGVSZXNwb25zZSh7IHN1Y2Nlc3M6IGZhbHNlLCBjb2RlOiBDb2Rlcy5VTktOT1dOX01FVEhPRCB9KTtcbiAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3BvbnNlKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgIH1cbn07XG4vLy8vICg1LTEpIHN0YXJ0IHRyYW5zY3JpYmVcbmNvbnN0IGhhbmRsZVBvc3RTdGFydFRyYW5zY3JpYmUgPSBhc3luYyAoYWNjZXNzVG9rZW46IHN0cmluZywgcGF0aFBhcmFtczogeyBba2V5OiBzdHJpbmddOiBzdHJpbmcgfSwgYm9keTogYW55LCBjYWxsYmFjazogYW55KSA9PiB7XG4gICAgbGV0IHJlczogUmVzcG9uc2VCb2R5O1xuICAgIGNvbnN0IHBhcmFtcyA9IEpTT04ucGFyc2UoYm9keSkgYXMgU3RhcnRUcmFuc2NyaWJlUmVxdWVzdDtcbiAgICBjb25zdCBtZWV0aW5nTmFtZSA9IHBhdGhQYXJhbXNbXCJtZWV0aW5nTmFtZVwiXTtcbiAgICBjb25zdCBhdHRlbmRlZUlkID0gcGF0aFBhcmFtc1tcImF0dGVuZGVlSWRcIl07XG4gICAgLy8vLyAoMSkgSWYgdGhlcmUgaXMgbm8gbWVldGluZywgcmV0dXJuIGZhaVxuICAgIGxldCBlbWFpbCA9IFwiXCI7XG4gICAgdHJ5IHtcbiAgICAgICAgZW1haWwgPSAoYXdhaXQgZ2V0RW1haWxGcm9tQWNjZXNzVG9rZW4oYWNjZXNzVG9rZW4pKSB8fCBcIlwiO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgcmVzID0ge1xuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICBjb2RlOiBDb2Rlcy5OT19TVUNIX0FOX0FUVEVOREVFLFxuICAgICAgICB9O1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IGdlbmVyYXRlUmVzcG9uc2UocmVzKTtcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzcG9uc2UpO1xuICAgIH1cbiAgICAvLy8gKDIpXG4gICAgc3RhcnRUcmFuc2NyaWJlKGVtYWlsLCBtZWV0aW5nTmFtZSwgcGFyYW1zLmxhbmcpO1xuICAgIHJlcyA9IHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgY29kZTogQ29kZXMuU1VDQ0VTUyxcbiAgICB9O1xuICAgIGNvbnN0IHJlc3BvbnNlID0gZ2VuZXJhdGVSZXNwb25zZShyZXMpO1xuICAgIGNhbGxiYWNrKG51bGwsIHJlc3BvbnNlKTtcbn07XG4vLy8vICg1LTIpIHN0b3AgdHJhbnNjcmliZVxuY29uc3QgaGFuZGxlUG9zdFN0b3BUcmFuc2NyaWJlID0gYXN5bmMgKGFjY2Vzc1Rva2VuOiBzdHJpbmcsIHBhdGhQYXJhbXM6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0sIGJvZHk6IGFueSwgY2FsbGJhY2s6IGFueSkgPT4ge1xuICAgIGxldCByZXM6IFJlc3BvbnNlQm9keTtcbiAgICBjb25zdCBwYXJhbXMgPSBKU09OLnBhcnNlKGJvZHkpIGFzIFN0b3BUcmFuc2NyaWJlUmVxdWVzdDtcbiAgICBjb25zdCBtZWV0aW5nTmFtZSA9IHBhdGhQYXJhbXNbXCJtZWV0aW5nTmFtZVwiXTtcbiAgICBjb25zdCBhdHRlbmRlZUlkID0gcGF0aFBhcmFtc1tcImF0dGVuZGVlSWRcIl07XG4gICAgLy8vLyAoMSkgSWYgdGhlcmUgaXMgbm8gbWVldGluZywgcmV0dXJuIGZhaVxuICAgIGxldCBlbWFpbCA9IFwiXCI7XG4gICAgdHJ5IHtcbiAgICAgICAgZW1haWwgPSAoYXdhaXQgZ2V0RW1haWxGcm9tQWNjZXNzVG9rZW4oYWNjZXNzVG9rZW4pKSB8fCBcIlwiO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgcmVzID0ge1xuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICBjb2RlOiBDb2Rlcy5OT19TVUNIX0FOX0FUVEVOREVFLFxuICAgICAgICB9O1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IGdlbmVyYXRlUmVzcG9uc2UocmVzKTtcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzcG9uc2UpO1xuICAgIH1cbiAgICAvLy8gKDIpXG4gICAgc3RvcFRyYW5zY3JpYmUoZW1haWwsIG1lZXRpbmdOYW1lKTtcbiAgICByZXMgPSB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGNvZGU6IENvZGVzLlNVQ0NFU1MsXG4gICAgfTtcbiAgICBjb25zdCByZXNwb25zZSA9IGdlbmVyYXRlUmVzcG9uc2UocmVzKTtcbiAgICBjYWxsYmFjayhudWxsLCByZXNwb25zZSk7XG59O1xuIl19