"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.handler = void 0;
const aws_sdk_1 = require("aws-sdk");
const backend_request_1 = require("./backend_request");
const meeting_1 = require("./meeting");
const util_1 = require("./util");
var meetingTableName = process.env.MEETING_TABLE_NAME;
var attendeesTableName = process.env.ATTENDEE_TABLE_NAME;
var ddb = new aws_sdk_1.DynamoDB();
const Methods = {
    GET: "GET",
    POST: "POST",
    DELETE: "DELETE",
};
const Resources = {
    Root: "/",
    Meetings: "/meetings",
    Meeting: "/meetings/{meetingName}",
    Attendees: "/meetings/{meetingName}/attendees",
    Attendee: "/meetings/{meetingName}/attendees/{attendeeId}",
    Operation: "/meetings/{meetingName}/attendees/{attendeeId}/operations/{operation}",
};
const Operations = {
    StartTranscribe: "start-transcribe",
    StopTranscribe: "stop-transcribe",
};
const Codes = {
    SUCCESS: "SUCCESS",
    UNKNOWN_RESOURCE: "UNKNOWN_RESOURCE",
    UNKNOWN_METHOD: "UNKNOWN_METHOD",
    TOKEN_ERROR: "TOKEN_ERROR",
    PARAMETER_ERROR: "PARAMETER_ERROR",
    NO_SUCH_A_MEETING_ROOM: "NO_SUCH_A_MEETING_ROOM",
    NO_SUCH_AN_ATTENDEE: "NO_SUCH_AN_ATTENDEE",
};
const handler = (event, context, callback) => {
    console.log(event);
    console.log("resource:", event.resource);
    console.log("pathPArameters:", event.pathParameters);
    console.log("method", event.httpMethod);
    console.log("body", event.body);
    const resource = event.resource;
    const pathParams = event.pathParameters;
    const method = event.httpMethod;
    const body = event.body;
    const accessToken = event.headers["x-flect-access-token"];
    console.log("pathParams", pathParams);
    switch (resource) {
        case Resources.Root:
            handleRoot(accessToken, method, pathParams, body, callback);
            break;
        case Resources.Meetings:
            handleMeetings(accessToken, method, pathParams, body, callback);
            break;
        case Resources.Meeting:
            handleMeeting(accessToken, method, pathParams, body, callback);
            break;
        case Resources.Attendees:
            handleAttendees(accessToken, method, pathParams, body, callback);
            break;
        case Resources.Attendee:
            handleAttendee(accessToken, method, pathParams, body, callback);
            break;
        case Resources.Operation:
            handleOperation(accessToken, method, pathParams, body, callback);
            break;
        default:
            console.log(`Unknwon resource name: ${resource}`);
            const response = (0, util_1.generateResponse)({ success: false, code: Codes.UNKNOWN_RESOURCE });
            callback(null, response);
    }
};
exports.handler = handler;
// (0) Root
const handleRoot = (accessToken, method, pathParams, body, callback) => {
    console.log(`HANDLE ROOT: ${method} ${body}`);
    const response = (0, util_1.generateResponse)({ success: true, code: Codes.SUCCESS });
    callback(null, response);
};
// (1) meetings
const handleMeetings = (accessToken, method, pathParams, body, callback) => {
    console.log(`HANDLE Meetings: ${method} ${body}`);
    switch (method) {
        case Methods.GET:
            handleGetMeetings(accessToken, pathParams, body, callback);
            break;
        case Methods.POST:
            handlePostMeetings(accessToken, pathParams, body, callback);
            break;
        default:
            console.log(`Unknwon method: ${method}`);
            const response = (0, util_1.generateResponse)({ success: false, code: Codes.UNKNOWN_METHOD });
            callback(null, response);
            break;
    }
};
//// (1-1) get meetings
const handleGetMeetings = (accessToken, pathParams, body, callback) => {
    ////// Not implemented
    const response = (0, util_1.generateResponse)({ success: true, code: Codes.SUCCESS });
    callback(null, response);
};
//// (1-2) post meetings
const handlePostMeetings = async (accessToken, pathParams, body, callback) => {
    const params = JSON.parse(body);
    let email;
    try {
        email = await (0, util_1.getEmailFromAccessToken)(accessToken);
    }
    catch (e) {
        console.log(e);
    }
    let res;
    if (email) {
        const result = await (0, meeting_1.createMeeting)({
            email,
            meetingName: params.meetingName,
            region: params.region,
        });
        const httpRes = {
            created: result.created,
            meetingId: result.meetingId,
            meetingName: result.meetingName,
            ownerId: result.ownerId,
        };
        res = {
            success: true,
            code: Codes.SUCCESS,
            data: httpRes,
        };
    }
    else {
        res = {
            success: false,
            code: Codes.TOKEN_ERROR,
        };
    }
    const response = (0, util_1.generateResponse)(res);
    callback(null, response);
};
// (2) meetings
const handleMeeting = (accessToken, method, pathParams, body, callback) => {
    console.log(`HANDLE Meeting: ${method} ${body}`);
    switch (method) {
        case Methods.GET:
            handleGetMeeting(accessToken, pathParams, body, callback);
            break;
        case Methods.DELETE:
            handleDeleteMeeting(accessToken, pathParams, body, callback);
            break;
        default:
            console.log(`Unknwon method: ${method}`);
            const response = (0, util_1.generateResponse)({ success: false, code: Codes.UNKNOWN_METHOD });
            callback(null, response);
            break;
    }
};
//// (2-1) Get Meeting
const handleGetMeeting = async (accessToken, pathParams, body, callback) => {
    let res;
    const meetingName = pathParams["meetingName"];
    let email = "";
    try {
        email = (await (0, util_1.getEmailFromAccessToken)(accessToken)) || "";
    }
    catch (e) {
        res = {
            success: false,
            code: Codes.NO_SUCH_AN_ATTENDEE,
        };
        const response = (0, util_1.generateResponse)(res);
        callback(null, response);
    }
    if (!meetingName) {
        console.log(`parameter error: ${meetingName}`);
        res = {
            success: false,
            code: Codes.PARAMETER_ERROR,
        };
    }
    else {
        const result = await (0, meeting_1.getMeetingInfo)({ email, meetingName });
        if (!result) {
            res = {
                success: false,
                code: Codes.NO_SUCH_A_MEETING_ROOM,
            };
        }
        else {
            const httpRes = {
                meetingName: result.meetingName,
                meetingId: result.meetingId,
                meeting: result.meeting,
                metadata: result.metadata,
                hmmTaskArn: result.hmmTaskArn,
            };
            res = {
                success: true,
                code: Codes.SUCCESS,
                data: result,
            };
        }
    }
    const response = (0, util_1.generateResponse)(res);
    callback(null, response);
};
//// (2-2) Delete Meeting
const handleDeleteMeeting = async (accessToken, pathParams, body, callback) => {
    let res;
    const meetingName = pathParams["meetingName"];
    if (!meetingName) {
        console.log(`parameter error: ${meetingName}`);
        res = {
            success: false,
            code: Codes.PARAMETER_ERROR,
        };
    }
    else {
        await (0, meeting_1.deleteMeeting)({ meetingName });
        res = {
            success: true,
            code: Codes.SUCCESS,
        };
    }
    const response = (0, util_1.generateResponse)(res);
    callback(null, response);
};
// (3) attendees
const handleAttendees = (accessToken, method, pathParams, body, callback) => {
    console.log(`HANDLE attendees: ${method} ${body}`);
    switch (method) {
        case Methods.GET:
            handleGetAttendees(accessToken, pathParams, body, callback);
            break;
        case Methods.POST:
            handlePostAttendees(accessToken, pathParams, body, callback);
            break;
        default:
            console.log(`Unknwon method: ${method}`);
            const response = (0, util_1.generateResponse)({ success: false, code: Codes.UNKNOWN_METHOD });
            callback(null, response);
            break;
    }
};
//// (3-1) Get Attendees
const handleGetAttendees = async (accessToken, pathParams, body, callback) => {
    // let res: ResponseBody;
    // const response = generateResponse(res);
    // callback(null, response);
};
//// (3-2) Post Attendees
const handlePostAttendees = async (accessToken, pathParams, body, callback) => {
    let res;
    const params = JSON.parse(body);
    const joinInfo = await (0, meeting_1.joinMeeting)({
        meetingName: params.meetingName,
        attendeeName: params.attendeeName,
    });
    if ("exception" in joinInfo) {
        const exception = joinInfo;
        if (exception.code === backend_request_1.BackendJoinMeetingExceptionType.NO_MEETING_FOUND) {
            res = {
                success: false,
                code: Codes.NO_SUCH_A_MEETING_ROOM,
            };
        }
        else {
            res = {
                success: false,
                code: Codes.PARAMETER_ERROR,
            };
        }
    }
    else {
        const httpRes = {
            meetingName: joinInfo.meetingName,
            meeting: joinInfo.meeting,
            attendee: joinInfo.attendee,
        };
        res = {
            success: true,
            code: Codes.SUCCESS,
            data: httpRes,
        };
    }
    const response = (0, util_1.generateResponse)(res);
    callback(null, response);
};
// (4) attendees
const handleAttendee = (accessToken, method, pathParams, body, callback) => {
    console.log(`HANDLE attendee: ${method} ${body}`);
    switch (method) {
        case Methods.GET:
            handleGetAttendee(accessToken, pathParams, body, callback);
            break;
        default:
            console.log(`Unknwon method: ${method}`);
            const response = (0, util_1.generateResponse)({ success: false, code: Codes.UNKNOWN_METHOD });
            callback(null, response);
            break;
    }
};
//// (4-1) Get Attendee
const handleGetAttendee = async (accessToken, pathParams, body, callback) => {
    let res;
    const meetingName = pathParams["meetingName"];
    const attendeeId = pathParams["attendeeId"];
    if (!meetingName || !attendeeId) {
        console.log(`parameter error: ${meetingName}, ${attendeeId}`);
        res = {
            success: false,
            code: Codes.PARAMETER_ERROR,
        };
    }
    else {
        const attendeeInfo = await (0, meeting_1.getAttendeeInfo)({ meetingName, attendeeId });
        if ("exception" in attendeeInfo) {
            const exception = attendeeInfo;
            if (exception.code === backend_request_1.BackendGetAttendeeInfoExceptionType.NO_ATTENDEE_FOUND) {
                res = {
                    success: false,
                    code: Codes.NO_SUCH_AN_ATTENDEE,
                };
            }
            else {
                res = {
                    success: false,
                    code: Codes.PARAMETER_ERROR,
                };
            }
        }
        else {
            const httpRes = {
                attendeeId: attendeeInfo.attendeeId,
                attendeeName: attendeeInfo.attendeeName,
            };
            res = {
                success: true,
                code: Codes.SUCCESS,
                data: httpRes,
            };
        }
    }
    const response = (0, util_1.generateResponse)(res);
    callback(null, response);
};
// (5) Operation
const handleOperation = (accessToken, method, pathParams, body, callback) => {
    console.log(`HANDLE operation: ${method} ${body}`);
    const meetingName = pathParams["meetingName"];
    const attendeeId = pathParams["attendeeId"];
    const operation = pathParams["operation"];
    switch (method) {
        case Methods.POST:
            if (operation === Operations.StartTranscribe) {
                handlePostStartTranscribe(accessToken, pathParams, body, callback);
            }
            else if (operation === Operations.StopTranscribe) {
                handlePostStopTranscribe(accessToken, pathParams, body, callback);
            }
            break;
        default:
            console.log(`Unknwon method: ${method}`);
            const response = (0, util_1.generateResponse)({ success: false, code: Codes.UNKNOWN_METHOD });
            callback(null, response);
            break;
    }
};
//// (5-1) start transcribe
const handlePostStartTranscribe = async (accessToken, pathParams, body, callback) => {
    let res;
    const params = JSON.parse(body);
    const meetingName = pathParams["meetingName"];
    const attendeeId = pathParams["attendeeId"];
    //// (1) If there is no meeting, return fai
    let email = "";
    try {
        email = (await (0, util_1.getEmailFromAccessToken)(accessToken)) || "";
    }
    catch (e) {
        res = {
            success: false,
            code: Codes.NO_SUCH_AN_ATTENDEE,
        };
        const response = (0, util_1.generateResponse)(res);
        callback(null, response);
    }
    /// (2)
    (0, meeting_1.startTranscribe)({
        email,
        meetingName,
        lang: params.lang,
    });
    res = {
        success: true,
        code: Codes.SUCCESS,
    };
    const response = (0, util_1.generateResponse)(res);
    callback(null, response);
};
//// (5-2) stop transcribe
const handlePostStopTranscribe = async (accessToken, pathParams, body, callback) => {
    let res;
    const params = JSON.parse(body);
    const meetingName = pathParams["meetingName"];
    const attendeeId = pathParams["attendeeId"];
    //// (1) If there is no meeting, return fai
    let email = "";
    try {
        email = (await (0, util_1.getEmailFromAccessToken)(accessToken)) || "";
    }
    catch (e) {
        res = {
            success: false,
            code: Codes.NO_SUCH_AN_ATTENDEE,
        };
        const response = (0, util_1.generateResponse)(res);
        callback(null, response);
    }
    /// (2)
    (0, meeting_1.stopTranscribe)({
        email,
        meetingName,
    });
    res = {
        success: true,
        code: Codes.SUCCESS,
    };
    const response = (0, util_1.generateResponse)(res);
    callback(null, response);
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSxxQ0FBbUM7QUFDbkMsdURBQXVLO0FBR3ZLLHVDQUF3STtBQUN4SSxpQ0FBbUU7QUFFbkUsSUFBSSxnQkFBZ0IsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLGtCQUFtQixDQUFDO0FBQ3ZELElBQUksa0JBQWtCLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxtQkFBb0IsQ0FBQztBQUMxRCxJQUFJLEdBQUcsR0FBRyxJQUFJLGtCQUFRLEVBQUUsQ0FBQztBQUV6QixNQUFNLE9BQU8sR0FBRztJQUNaLEdBQUcsRUFBRSxLQUFLO0lBQ1YsSUFBSSxFQUFFLE1BQU07SUFDWixNQUFNLEVBQUUsUUFBUTtDQUNWLENBQUM7QUFHWCxNQUFNLFNBQVMsR0FBRztJQUNkLElBQUksRUFBRSxHQUFHO0lBQ1QsUUFBUSxFQUFFLFdBQVc7SUFDckIsT0FBTyxFQUFFLHlCQUF5QjtJQUNsQyxTQUFTLEVBQUUsbUNBQW1DO0lBQzlDLFFBQVEsRUFBRSxnREFBZ0Q7SUFDMUQsU0FBUyxFQUFFLHVFQUF1RTtDQUM1RSxDQUFDO0FBR1gsTUFBTSxVQUFVLEdBQUc7SUFDZixlQUFlLEVBQUUsa0JBQWtCO0lBQ25DLGNBQWMsRUFBRSxpQkFBaUI7Q0FDM0IsQ0FBQztBQUdYLE1BQU0sS0FBSyxHQUFHO0lBQ1YsT0FBTyxFQUFFLFNBQVM7SUFDbEIsZ0JBQWdCLEVBQUUsa0JBQWtCO0lBQ3BDLGNBQWMsRUFBRSxnQkFBZ0I7SUFDaEMsV0FBVyxFQUFFLGFBQWE7SUFDMUIsZUFBZSxFQUFFLGlCQUFpQjtJQUNsQyxzQkFBc0IsRUFBRSx3QkFBd0I7SUFDaEQsbUJBQW1CLEVBQUUscUJBQXFCO0NBQ3BDLENBQUM7QUFHSixNQUFNLE9BQU8sR0FBRyxDQUFDLEtBQVUsRUFBRSxPQUFZLEVBQUUsUUFBYSxFQUFFLEVBQUU7SUFDL0QsT0FBTyxDQUFDLEdB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QixFQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ3ZDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsUUFBUSxDQUFDLENBQUM7QUFDN0IsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRHluYW1vREIgfSBmcm9tIFwiYXdzLXNka1wiO1xuaW1wb3J0IHsgQmFja2VuZEdldEF0dGVuZGVlSW5mb0V4Y2VwdGlvbiwgQmFja2VuZEdldEF0dGVuZGVlSW5mb0V4Y2VwdGlvblR5cGUsIEJhY2tlbmRKb2luTWVldGluZ0V4Y2VwdGlvbiwgQmFja2VuZEpvaW5NZWV0aW5nRXhjZXB0aW9uVHlwZSB9IGZyb20gXCIuL2JhY2tlbmRfcmVxdWVzdFwiO1xuaW1wb3J0IHsgU3RhcnRUcmFuc2NyaWJlUmVxdWVzdCwgU3RvcFRyYW5zY3JpYmVSZXF1ZXN0IH0gZnJvbSBcIi4vY29uc3RcIjtcbmltcG9ydCB7IEhUVFBDcmVhdGVNZWV0aW5nUmVxdWVzdCwgSFRUUENyZWF0ZU1lZXRpbmdSZXNwb25zZSwgSFRUUEdldEF0dGVuZGVlSW5mb1Jlc3BvbnNlLCBIVFRQR2V0TWVldGluZ0luZm9SZXNwb25zZSwgSFRUUEpvaW5NZWV0aW5nUmVxdWVzdCwgSFRUUEpvaW5NZWV0aW5nUmVzcG9uc2UsIEhUVFBSZXNwb25zZUJvZHkgfSBmcm9tIFwiLi9odHRwX3JlcXVlc3RcIjtcbmltcG9ydCB7IGNyZWF0ZU1lZXRpbmcsIGRlbGV0ZU1lZXRpbmcsIGdldEF0dGVuZGVlSW5mbywgZ2V0TWVldGluZ0luZm8sIGpvaW5NZWV0aW5nLCBzdGFydFRyYW5zY3JpYmUsIHN0b3BUcmFuc2NyaWJlIH0gZnJvbSBcIi4vbWVldGluZ1wiO1xuaW1wb3J0IHsgZ2VuZXJhdGVSZXNwb25zZSwgZ2V0RW1haWxGcm9tQWNjZXNzVG9rZW4gfSBmcm9tIFwiLi91dGlsXCI7XG5cbnZhciBtZWV0aW5nVGFibGVOYW1lID0gcHJvY2Vzcy5lbnYuTUVFVElOR19UQUJMRV9OQU1FITtcbnZhciBhdHRlbmRlZXNUYWJsZU5hbWUgPSBwcm9jZXNzLmVudi5BVFRFTkRFRV9UQUJMRV9OQU1FITtcbnZhciBkZGIgPSBuZXcgRHluYW1vREIoKTtcblxuY29uc3QgTWV0aG9kcyA9IHtcbiAgICBHRVQ6IFwiR0VUXCIsXG4gICAgUE9TVDogXCJQT1NUXCIsXG4gICAgREVMRVRFOiBcIkRFTEVURVwiLFxufSBhcyBjb25zdDtcbnR5cGUgTWV0aG9kcyA9IHR5cGVvZiBNZXRob2RzW2tleW9mIHR5cGVvZiBNZXRob2RzXTtcblxuY29uc3QgUmVzb3VyY2VzID0ge1xuICAgIFJvb3Q6IFwiL1wiLFxuICAgIE1lZXRpbmdzOiBcIi9tZWV0aW5nc1wiLFxuICAgIE1lZXRpbmc6IFwiL21lZXRpbmdzL3ttZWV0aW5nTmFtZX1cIixcbiAgICBBdHRlbmRlZXM6IFwiL21lZXRpbmdzL3ttZWV0aW5nTmFtZX0vYXR0ZW5kZWVzXCIsXG4gICAgQXR0ZW5kZWU6IFwiL21lZXRpbmdzL3ttZWV0aW5nTmFtZX0vYXR0ZW5kZWVzL3thdHRlbmRlZUlkfVwiLFxuICAgIE9wZXJhdGlvbjogXCIvbWVldGluZ3Mve21lZXRpbmdOYW1lfS9hdHRlbmRlZXMve2F0dGVuZGVlSWR9L29wZXJhdGlvbnMve29wZXJhdGlvbn1cIixcbn0gYXMgY29uc3Q7XG50eXBlIFJlc291cmNlcyA9IHR5cGVvZiBSZXNvdXJjZXNba2V5b2YgdHlwZW9mIFJlc291cmNlc107XG5cbmNvbnN0IE9wZXJhdGlvbnMgPSB7XG4gICAgU3RhcnRUcmFuc2NyaWJlOiBcInN0YXJ0LXRyYW5zY3JpYmVcIixcbiAgICBTdG9wVHJhbnNjcmliZTogXCJzdG9wLXRyYW5zY3JpYmVcIixcbn0gYXMgY29uc3Q7XG50eXBlIE9wZXJhdGlvbnMgPSB0eXBlb2YgT3BlcmF0aW9uc1trZXlvZiB0eXBlb2YgT3BlcmF0aW9uc107XG5cbmNvbnN0IENvZGVzID0ge1xuICAgIFNVQ0NFU1M6IFwiU1VDQ0VTU1wiLFxuICAgIFVOS05PV05fUkVTT1VSQ0U6IFwiVU5LTk9XTl9SRVNPVVJDRVwiLFxuICAgIFVOS05PV05fTUVUSE9EOiBcIlVOS05PV05fTUVUSE9EXCIsXG4gICAgVE9LRU5fRVJST1I6IFwiVE9LRU5fRVJST1JcIixcbiAgICBQQVJBTUVURVJfRVJST1I6IFwiUEFSQU1FVEVSX0VSUk9SXCIsXG4gICAgTk9fU1VDSF9BX01FRVRJTkdfUk9PTTogXCJOT19TVUNIX0FfTUVFVElOR19ST09NXCIsXG4gICAgTk9fU1VDSF9BTl9BVFRFTkRFRTogXCJOT19TVUNIX0FOX0FUVEVOREVFXCIsXG59IGFzIGNvbnN0O1xudHlwZSBDb2RlID0gdHlwZW9mIENvZGVzW2tleW9mIHR5cGVvZiBDb2Rlc107XG5cbmV4cG9ydCBjb25zdCBoYW5kbGVyID0gKGV2ZW50OiBhbnksIGNvbnRleHQ6IGFueSwgY2FsbGJhY2s6IGFueSkgPT4ge1xuICAgIGNvbnNvbGUubG9nKGV2ZW50KTtcbiAgICBjb25zb2xlLmxvZyhcInJlc291cmNlOlwiLCBldmVudC5yZXNvdXJjZSk7XG4gICAgY29uc29sZS5sb2coXCJwYXRoUEFyYW1ldGVyczpcIiwgZXZlbnQucGF0aFBhcmFtZXRlcnMpO1xuICAgIGNvbnNvbGUubG9nKFwibWV0aG9kXCIsIGV2ZW50Lmh0dHBNZXRob2QpO1xuICAgIGNvbnNvbGUubG9nKFwiYm9keVwiLCBldmVudC5ib2R5KTtcblxuICAgIGNvbnN0IHJlc291cmNlID0gZXZlbnQucmVzb3VyY2U7XG4gICAgY29uc3QgcGF0aFBhcmFtcyA9IGV2ZW50LnBhdGhQYXJhbWV0ZXJzO1xuICAgIGNvbnN0IG1ldGhvZCA9IGV2ZW50Lmh0dHBNZXRob2Q7XG4gICAgY29uc3QgYm9keSA9IGV2ZW50LmJvZHk7XG4gICAgY29uc3QgYWNjZXNzVG9rZW4gPSBldmVudC5oZWFkZXJzW1wieC1mbGVjdC1hY2Nlc3MtdG9rZW5cIl07XG5cbiAgICBjb25zb2xlLmxvZyhcInBhdGhQYXJhbXNcIiwgcGF0aFBhcmFtcyk7XG5cbiAgICBzd2l0Y2ggKHJlc291cmNlKSB7XG4gICAgICAgIGNhc2UgUmVzb3VyY2VzLlJvb3Q6XG4gICAgICAgICAgICBoYW5kbGVSb290KGFjY2Vzc1Rva2VuLCBtZXRob2QsIHBhdGhQYXJhbXMsIGJvZHksIGNhbGxiYWNrKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFJlc291cmNlcy5NZWV0aW5nczpcbiAgICAgICAgICAgIGhhbmRsZU1lZXRpbmdzKGFjY2Vzc1Rva2VuLCBtZXRob2QsIHBhdGhQYXJhbXMsIGJvZHksIGNhbGxiYWNrKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFJlc291cmNlcy5NZWV0aW5nOlxuICAgICAgICAgICAgaGFuZGxlTWVldGluZyhhY2Nlc3NUb2tlbiwgbWV0aG9kLCBwYXRoUGFyYW1zLCBib2R5LCBjYWxsYmFjayk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBSZXNvdXJjZXMuQXR0ZW5kZWVzOlxuICAgICAgICAgICAgaGFuZGxlQXR0ZW5kZWVzKGFjY2Vzc1Rva2VuLCBtZXRob2QsIHBhdGhQYXJhbXMsIGJvZHksIGNhbGxiYWNrKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFJlc291cmNlcy5BdHRlbmRlZTpcbiAgICAgICAgICAgIGhhbmRsZUF0dGVuZGVlKGFjY2Vzc1Rva2VuLCBtZXRob2QsIHBhdGhQYXJhbXMsIGJvZHksIGNhbGxiYWNrKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFJlc291cmNlcy5PcGVyYXRpb246XG4gICAgICAgICAgICBoYW5kbGVPcGVyYXRpb24oYWNjZXNzVG9rZW4sIG1ldGhvZCwgcGF0aFBhcmFtcywgYm9keSwgY2FsbGJhY2spO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgVW5rbndvbiByZXNvdXJjZSBuYW1lOiAke3Jlc291cmNlfWApO1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBnZW5lcmF0ZVJlc3BvbnNlKHsgc3VjY2VzczogZmFsc2UsIGNvZGU6IENvZGVzLlVOS05PV05fUkVTT1VSQ0UgfSk7XG4gICAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXNwb25zZSk7XG4gICAgfVxufTtcblxuLy8gKDApIFJvb3RcbmNvbnN0IGhhbmRsZVJvb3QgPSAoYWNjZXNzVG9rZW46IHN0cmluZywgbWV0aG9kOiBzdHJpbmcsIHBhdGhQYXJhbXM6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0sIGJvZHk6IGFueSwgY2FsbGJhY2s6IGFueSkgPT4ge1xuICAgIGNvbnNvbGUubG9nKGBIQU5ETEUgUk9PVDogJHttZXRob2R9ICR7Ym9keX1gKTtcbiAgICBjb25zdCByZXNwb25zZSA9IGdlbmVyYXRlUmVzcG9uc2UoeyBzdWNjZXNzOiB0cnVlLCBjb2RlOiBDb2Rlcy5TVUNDRVNTIH0pO1xuICAgIGNhbGxiYWNrKG51bGwsIHJlc3BvbnNlKTtcbn07XG5cbi8vICgxKSBtZWV0aW5nc1xuY29uc3QgaGFuZGxlTWVldGluZ3MgPSAoYWNjZXNzVG9rZW46IHN0cmluZywgbWV0aG9kOiBzdHJpbmcsIHBhdGhQYXJhbXM6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0sIGJvZHk6IGFueSwgY2FsbGJhY2s6IGFueSkgPT4ge1xuICAgIGNvbnNvbGUubG9nKGBIQU5ETEUgTWVldGluZ3M6ICR7bWV0aG9kfSAke2JvZHl9YCk7XG4gICAgc3dpdGNoIChtZXRob2QpIHtcbiAgICAgICAgY2FzZSBNZXRob2RzLkdFVDpcbiAgICAgICAgICAgIGhhbmRsZUdldE1lZXRpbmdzKGFjY2Vzc1Rva2VuLCBwYXRoUGFyYW1zLCBib2R5LCBjYWxsYmFjayk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBNZXRob2RzLlBPU1Q6XG4gICAgICAgICAgICBoYW5kbGVQb3N0TWVldGluZ3MoYWNjZXNzVG9rZW4sIHBhdGhQYXJhbXMsIGJvZHksIGNhbGxiYWNrKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgY29uc29sZS5sb2coYFVua253b24gbWV0aG9kOiAke21ldGhvZH1gKTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gZ2VuZXJhdGVSZXNwb25zZSh7IHN1Y2Nlc3M6IGZhbHNlLCBjb2RlOiBDb2Rlcy5VTktOT1dOX01FVEhPRCB9KTtcbiAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3BvbnNlKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgIH1cbn07XG4vLy8vICgxLTEpIGdldCBtZWV0aW5nc1xuY29uc3QgaGFuZGxlR2V0TWVldGluZ3MgPSAoYWNjZXNzVG9rZW46IHN0cmluZywgcGF0aFBhcmFtczogeyBba2V5OiBzdHJpbmddOiBzdHJpbmcgfSwgYm9keTogYW55LCBjYWxsYmFjazogYW55KSA9PiB7XG4gICAgLy8vLy8vIE5vdCBpbXBsZW1lbnRlZFxuICAgIGNvbnN0IHJlc3BvbnNlID0gZ2VuZXJhdGVSZXNwb25zZSh7IHN1Y2Nlc3M6IHRydWUsIGNvZGU6IENvZGVzLlNVQ0NFU1MgfSk7XG4gICAgY2FsbGJhY2sobnVsbCwgcmVzcG9uc2UpO1xufTtcbi8vLy8gKDEtMikgcG9zdCBtZWV0aW5nc1xuY29uc3QgaGFuZGxlUG9zdE1lZXRpbmdzID0gYXN5bmMgKGFjY2Vzc1Rva2VuOiBzdHJpbmcsIHBhdGhQYXJhbXM6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0sIGJvZHk6IGFueSwgY2FsbGJhY2s6IGFueSkgPT4ge1xuICAgIGNvbnN0IHBhcmFtcyA9IEpTT04ucGFyc2UoYm9keSkgYXMgSFRUUENyZWF0ZU1lZXRpbmdSZXF1ZXN0O1xuICAgIGxldCBlbWFpbDtcbiAgICB0cnkge1xuICAgICAgICBlbWFpbCA9IGF3YWl0IGdldEVtYWlsRnJvbUFjY2Vzc1Rva2VuKGFjY2Vzc1Rva2VuKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGUpO1xuICAgIH1cbiAgICBsZXQgcmVzOiBIVFRQUmVzcG9uc2VCb2R5O1xuICAgIGlmIChlbWFpbCkge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjcmVhdGVNZWV0aW5nKHtcbiAgICAgICAgICAgIGVtYWlsLFxuICAgICAgICAgICAgbWVldGluZ05hbWU6IHBhcmFtcy5tZWV0aW5nTmFtZSxcbiAgICAgICAgICAgIHJlZ2lvbjogcGFyYW1zLnJlZ2lvbixcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IGh0dHBSZXM6IEhUVFBDcmVhdGVNZWV0aW5nUmVzcG9uc2UgPSB7XG4gICAgICAgICAgICBjcmVhdGVkOiByZXN1bHQuY3JlYXRlZCxcbiAgICAgICAgICAgIG1lZXRpbmdJZDogcmVzdWx0Lm1lZXRpbmdJZCxcbiAgICAgICAgICAgIG1lZXRpbmdOYW1lOiByZXN1bHQubWVldGluZ05hbWUsXG4gICAgICAgICAgICBvd25lcklkOiByZXN1bHQub3duZXJJZCxcbiAgICAgICAgfTtcbiAgICAgICAgcmVzID0ge1xuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgIGNvZGU6IENvZGVzLlNVQ0NFU1MsXG4gICAgICAgICAgICBkYXRhOiBodHRwUmVzLFxuICAgICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHJlcyA9IHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgY29kZTogQ29kZXMuVE9LRU5fRVJST1IsXG4gICAgICAgIH07XG4gICAgfVxuICAgIGNvbnN0IHJlc3BvbnNlID0gZ2VuZXJhdGVSZXNwb25zZShyZXMpO1xuICAgIGNhbGxiYWNrKG51bGwsIHJlc3BvbnNlKTtcbn07XG4vLyAoMikgbWVldGluZ3NcbmNvbnN0IGhhbmRsZU1lZXRpbmcgPSAoYWNjZXNzVG9rZW46IHN0cmluZywgbWV0aG9kOiBzdHJpbmcsIHBhdGhQYXJhbXM6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0sIGJvZHk6IGFueSwgY2FsbGJhY2s6IGFueSkgPT4ge1xuICAgIGNvbnNvbGUubG9nKGBIQU5ETEUgTWVldGluZzogJHttZXRob2R9ICR7Ym9keX1gKTtcbiAgICBzd2l0Y2ggKG1ldGhvZCkge1xuICAgICAgICBjYXNlIE1ldGhvZHMuR0VUOlxuICAgICAgICAgICAgaGFuZGxlR2V0TWVldGluZyhhY2Nlc3NUb2tlbiwgcGF0aFBhcmFtcywgYm9keSwgY2FsbGJhY2spO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgTWV0aG9kcy5ERUxFVEU6XG4gICAgICAgICAgICBoYW5kbGVEZWxldGVNZWV0aW5nKGFjY2Vzc1Rva2VuLCBwYXRoUGFyYW1zLCBib2R5LCBjYWxsYmFjayk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBVbmtud29uIG1ldGhvZDogJHttZXRob2R9YCk7XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGdlbmVyYXRlUmVzcG9uc2UoeyBzdWNjZXNzOiBmYWxzZSwgY29kZTogQ29kZXMuVU5LTk9XTl9NRVRIT0QgfSk7XG4gICAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXNwb25zZSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICB9XG59O1xuLy8vLyAoMi0xKSBHZXQgTWVldGluZ1xuY29uc3QgaGFuZGxlR2V0TWVldGluZyA9IGFzeW5jIChhY2Nlc3NUb2tlbjogc3RyaW5nLCBwYXRoUGFyYW1zOiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9LCBib2R5OiBhbnksIGNhbGxiYWNrOiBhbnkpID0+IHtcbiAgICBsZXQgcmVzOiBIVFRQUmVzcG9uc2VCb2R5O1xuICAgIGNvbnN0IG1lZXRpbmdOYW1lID0gcGF0aFBhcmFtc1tcIm1lZXRpbmdOYW1lXCJdO1xuICAgIGxldCBlbWFpbCA9IFwiXCI7XG4gICAgdHJ5IHtcbiAgICAgICAgZW1haWwgPSAoYXdhaXQgZ2V0RW1haWxGcm9tQWNjZXNzVG9rZW4oYWNjZXNzVG9rZW4pKSB8fCBcIlwiO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgcmVzID0ge1xuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICBjb2RlOiBDb2Rlcy5OT19TVUNIX0FOX0FUVEVOREVFLFxuICAgICAgICB9O1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IGdlbmVyYXRlUmVzcG9uc2UocmVzKTtcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzcG9uc2UpO1xuICAgIH1cbiAgICBpZiAoIW1lZXRpbmdOYW1lKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGBwYXJhbWV0ZXIgZXJyb3I6ICR7bWVldGluZ05hbWV9YCk7XG4gICAgICAgIHJlcyA9IHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgY29kZTogQ29kZXMuUEFSQU1FVEVSX0VSUk9SLFxuICAgICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGdldE1lZXRpbmdJbmZvKHsgZW1haWwsIG1lZXRpbmdOYW1lIH0pO1xuICAgICAgICBpZiAoIXJlc3VsdCkge1xuICAgICAgICAgICAgcmVzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGNvZGU6IENvZGVzLk5PX1NVQ0hfQV9NRUVUSU5HX1JPT00sXG4gICAgICAgICAgICB9O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgaHR0cFJlczogSFRUUEdldE1lZXRpbmdJbmZvUmVzcG9uc2UgPSB7XG4gICAgICAgICAgICAgICAgbWVldGluZ05hbWU6IHJlc3VsdC5tZWV0aW5nTmFtZSxcbiAgICAgICAgICAgICAgICBtZWV0aW5nSWQ6IHJlc3VsdC5tZWV0aW5nSWQsXG4gICAgICAgICAgICAgICAgbWVldGluZzogcmVzdWx0Lm1lZXRpbmcsXG4gICAgICAgICAgICAgICAgbWV0YWRhdGE6IHJlc3VsdC5tZXRhZGF0YSxcbiAgICAgICAgICAgICAgICBobW1UYXNrQXJuOiByZXN1bHQuaG1tVGFza0FybixcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZXMgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgICAgICBjb2RlOiBDb2Rlcy5TVUNDRVNTLFxuICAgICAgICAgICAgICAgIGRhdGE6IHJlc3VsdCxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29uc3QgcmVzcG9uc2UgPSBnZW5lcmF0ZVJlc3BvbnNlKHJlcyk7XG4gICAgY2FsbGJhY2sobnVsbCwgcmVzcG9uc2UpO1xufTtcblxuLy8vLyAoMi0yKSBEZWxldGUgTWVldGluZ1xuY29uc3QgaGFuZGxlRGVsZXRlTWVldGluZyA9IGFzeW5jIChhY2Nlc3NUb2tlbjogc3RyaW5nLCBwYXRoUGFyYW1zOiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9LCBib2R5OiBhbnksIGNhbGxiYWNrOiBhbnkpID0+IHtcbiAgICBsZXQgcmVzOiBIVFRQUmVzcG9uc2VCb2R5O1xuICAgIGNvbnN0IG1lZXRpbmdOYW1lID0gcGF0aFBhcmFtc1tcIm1lZXRpbmdOYW1lXCJdO1xuICAgIGlmICghbWVldGluZ05hbWUpIHtcbiAgICAgICAgY29uc29sZS5sb2coYHBhcmFtZXRlciBlcnJvcjogJHttZWV0aW5nTmFtZX1gKTtcbiAgICAgICAgcmVzID0ge1xuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICBjb2RlOiBDb2Rlcy5QQVJBTUVURVJfRVJST1IsXG4gICAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgICAgYXdhaXQgZGVsZXRlTWVldGluZyh7IG1lZXRpbmdOYW1lIH0pO1xuICAgICAgICByZXMgPSB7XG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgY29kZTogQ29kZXMuU1VDQ0VTUyxcbiAgICAgICAgfTtcbiAgICB9XG4gICAgY29uc3QgcmVzcG9uc2UgPSBnZW5lcmF0ZVJlc3BvbnNlKHJlcyk7XG4gICAgY2FsbGJhY2sobnVsbCwgcmVzcG9uc2UpO1xufTtcblxuLy8gKDMpIGF0dGVuZGVlc1xuY29uc3QgaGFuZGxlQXR0ZW5kZWVzID0gKGFjY2Vzc1Rva2VuOiBzdHJpbmcsIG1ldGhvZDogc3RyaW5nLCBwYXRoUGFyYW1zOiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9LCBib2R5OiBhbnksIGNhbGxiYWNrOiBhbnkpID0+IHtcbiAgICBjb25zb2xlLmxvZyhgSEFORExFIGF0dGVuZGVlczogJHttZXRob2R9ICR7Ym9keX1gKTtcbiAgICBzd2l0Y2ggKG1ldGhvZCkge1xuICAgICAgICBjYXNlIE1ldGhvZHMuR0VUOlxuICAgICAgICAgICAgaGFuZGxlR2V0QXR0ZW5kZWVzKGFjY2Vzc1Rva2VuLCBwYXRoUGFyYW1zLCBib2R5LCBjYWxsYmFjayk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBNZXRob2RzLlBPU1Q6XG4gICAgICAgICAgICBoYW5kbGVQb3N0QXR0ZW5kZWVzKGFjY2Vzc1Rva2VuLCBwYXRoUGFyYW1zLCBib2R5LCBjYWxsYmFjayk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBVbmtud29uIG1ldGhvZDogJHttZXRob2R9YCk7XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGdlbmVyYXRlUmVzcG9uc2UoeyBzdWNjZXNzOiBmYWxzZSwgY29kZTogQ29kZXMuVU5LTk9XTl9NRVRIT0QgfSk7XG4gICAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXNwb25zZSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICB9XG59O1xuXG4vLy8vICgzLTEpIEdldCBBdHRlbmRlZXNcbmNvbnN0IGhhbmRsZUdldEF0dGVuZGVlcyA9IGFzeW5jIChhY2Nlc3NUb2tlbjogc3RyaW5nLCBwYXRoUGFyYW1zOiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9LCBib2R5OiBhbnksIGNhbGxiYWNrOiBhbnkpID0+IHtcbiAgICAvLyBsZXQgcmVzOiBSZXNwb25zZUJvZHk7XG4gICAgLy8gY29uc3QgcmVzcG9uc2UgPSBnZW5lcmF0ZVJlc3BvbnNlKHJlcyk7XG4gICAgLy8gY2FsbGJhY2sobnVsbCwgcmVzcG9uc2UpO1xufTtcbi8vLy8gKDMtMikgUG9zdCBBdHRlbmRlZXNcbmNvbnN0IGhhbmRsZVBvc3RBdHRlbmRlZXMgPSBhc3luYyAoYWNjZXNzVG9rZW46IHN0cmluZywgcGF0aFBhcmFtczogeyBba2V5OiBzdHJpbmddOiBzdHJpbmcgfSwgYm9keTogYW55LCBjYWxsYmFjazogYW55KSA9PiB7XG4gICAgbGV0IHJlczogSFRUUFJlc3BvbnNlQm9keTtcbiAgICBjb25zdCBwYXJhbXMgPSBKU09OLnBhcnNlKGJvZHkpIGFzIEhUVFBKb2luTWVldGluZ1JlcXVlc3Q7XG5cbiAgICBjb25zdCBqb2luSW5mbyA9IGF3YWl0IGpvaW5NZWV0aW5nKHtcbiAgICAgICAgbWVldGluZ05hbWU6IHBhcmFtcy5tZWV0aW5nTmFtZSxcbiAgICAgICAgYXR0ZW5kZWVOYW1lOiBwYXJhbXMuYXR0ZW5kZWVOYW1lLFxuICAgIH0pO1xuICAgIGlmIChcImV4Y2VwdGlvblwiIGluIGpvaW5JbmZvKSB7XG4gICAgICAgIGNvbnN0IGV4Y2VwdGlvbiA9IGpvaW5JbmZvIGFzIEJhY2tlbmRKb2luTWVldGluZ0V4Y2VwdGlvbjtcbiAgICAgICAgaWYgKGV4Y2VwdGlvbi5jb2RlID09PSBCYWNrZW5kSm9pbk1lZXRpbmdFeGNlcHRpb25UeXBlLk5PX01FRVRJTkdfRk9VTkQpIHtcbiAgICAgICAgICAgIHJlcyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBjb2RlOiBDb2Rlcy5OT19TVUNIX0FfTUVFVElOR19ST09NLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlcyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBjb2RlOiBDb2Rlcy5QQVJBTUVURVJfRVJST1IsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3QgaHR0cFJlczogSFRUUEpvaW5NZWV0aW5nUmVzcG9uc2UgPSB7XG4gICAgICAgICAgICBtZWV0aW5nTmFtZTogam9pbkluZm8ubWVldGluZ05hbWUsXG4gICAgICAgICAgICBtZWV0aW5nOiBqb2luSW5mby5tZWV0aW5nLFxuICAgICAgICAgICAgYXR0ZW5kZWU6IGpvaW5JbmZvLmF0dGVuZGVlLFxuICAgICAgICB9O1xuICAgICAgICByZXMgPSB7XG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgY29kZTogQ29kZXMuU1VDQ0VTUyxcbiAgICAgICAgICAgIGRhdGE6IGh0dHBSZXMsXG4gICAgICAgIH07XG4gICAgfVxuICAgIGNvbnN0IHJlc3BvbnNlID0gZ2VuZXJhdGVSZXNwb25zZShyZXMpO1xuICAgIGNhbGxiYWNrKG51bGwsIHJlc3BvbnNlKTtcbn07XG5cbi8vICg0KSBhdHRlbmRlZXNcbmNvbnN0IGhhbmRsZUF0dGVuZGVlID0gKGFjY2Vzc1Rva2VuOiBzdHJpbmcsIG1ldGhvZDogc3RyaW5nLCBwYXRoUGFyYW1zOiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9LCBib2R5OiBhbnksIGNhbGxiYWNrOiBhbnkpID0+IHtcbiAgICBjb25zb2xlLmxvZyhgSEFORExFIGF0dGVuZGVlOiAke21ldGhvZH0gJHtib2R5fWApO1xuICAgIHN3aXRjaCAobWV0aG9kKSB7XG4gICAgICAgIGNhc2UgTWV0aG9kcy5HRVQ6XG4gICAgICAgICAgICBoYW5kbGVHZXRBdHRlbmRlZShhY2Nlc3NUb2tlbiwgcGF0aFBhcmFtcywgYm9keSwgY2FsbGJhY2spO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgVW5rbndvbiBtZXRob2Q6ICR7bWV0aG9kfWApO1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBnZW5lcmF0ZVJlc3BvbnNlKHsgc3VjY2VzczogZmFsc2UsIGNvZGU6IENvZGVzLlVOS05PV05fTUVUSE9EIH0pO1xuICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzcG9uc2UpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgfVxufTtcblxuLy8vLyAoNC0xKSBHZXQgQXR0ZW5kZWVcbmNvbnN0IGhhbmRsZUdldEF0dGVuZGVlID0gYXN5bmMgKGFjY2Vzc1Rva2VuOiBzdHJpbmcsIHBhdGhQYXJhbXM6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0sIGJvZHk6IGFueSwgY2FsbGJhY2s6IGFueSkgPT4ge1xuICAgIGxldCByZXM6IEhUVFBSZXNwb25zZUJvZHk7XG4gICAgY29uc3QgbWVldGluZ05hbWUgPSBwYXRoUGFyYW1zW1wibWVldGluZ05hbWVcIl07XG4gICAgY29uc3QgYXR0ZW5kZWVJZCA9IHBhdGhQYXJhbXNbXCJhdHRlbmRlZUlkXCJdO1xuICAgIGlmICghbWVldGluZ05hbWUgfHwgIWF0dGVuZGVlSWQpIHtcbiAgICAgICAgY29uc29sZS5sb2coYHBhcmFtZXRlciBlcnJvcjogJHttZWV0aW5nTmFtZX0sICR7YXR0ZW5kZWVJZH1gKTtcbiAgICAgICAgcmVzID0ge1xuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICBjb2RlOiBDb2Rlcy5QQVJBTUVURVJfRVJST1IsXG4gICAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3QgYXR0ZW5kZWVJbmZvID0gYXdhaXQgZ2V0QXR0ZW5kZWVJbmZvKHsgbWVldGluZ05hbWUsIGF0dGVuZGVlSWQgfSk7XG5cbiAgICAgICAgaWYgKFwiZXhjZXB0aW9uXCIgaW4gYXR0ZW5kZWVJbmZvKSB7XG4gICAgICAgICAgICBjb25zdCBleGNlcHRpb24gPSBhdHRlbmRlZUluZm8gYXMgQmFja2VuZEdldEF0dGVuZGVlSW5mb0V4Y2VwdGlvbjtcbiAgICAgICAgICAgIGlmIChleGNlcHRpb24uY29kZSA9PT0gQmFja2VuZEdldEF0dGVuZGVlSW5mb0V4Y2VwdGlvblR5cGUuTk9fQVRURU5ERUVfRk9VTkQpIHtcbiAgICAgICAgICAgICAgICByZXMgPSB7XG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBjb2RlOiBDb2Rlcy5OT19TVUNIX0FOX0FUVEVOREVFLFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlcyA9IHtcbiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIGNvZGU6IENvZGVzLlBBUkFNRVRFUl9FUlJPUixcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgaHR0cFJlczogSFRUUEdldEF0dGVuZGVlSW5mb1Jlc3BvbnNlID0ge1xuICAgICAgICAgICAgICAgIGF0dGVuZGVlSWQ6IGF0dGVuZGVlSW5mby5hdHRlbmRlZUlkLFxuICAgICAgICAgICAgICAgIGF0dGVuZGVlTmFtZTogYXR0ZW5kZWVJbmZvLmF0dGVuZGVlTmFtZSxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZXMgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgICAgICBjb2RlOiBDb2Rlcy5TVUNDRVNTLFxuICAgICAgICAgICAgICAgIGRhdGE6IGh0dHBSZXMsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbnN0IHJlc3BvbnNlID0gZ2VuZXJhdGVSZXNwb25zZShyZXMpO1xuICAgIGNhbGxiYWNrKG51bGwsIHJlc3BvbnNlKTtcbn07XG5cbi8vICg1KSBPcGVyYXRpb25cbmNvbnN0IGhhbmRsZU9wZXJhdGlvbiA9IChhY2Nlc3NUb2tlbjogc3RyaW5nLCBtZXRob2Q6IHN0cmluZywgcGF0aFBhcmFtczogeyBba2V5OiBzdHJpbmddOiBzdHJpbmcgfSwgYm9keTogYW55LCBjYWxsYmFjazogYW55KSA9PiB7XG4gICAgY29uc29sZS5sb2coYEhBTkRMRSBvcGVyYXRpb246ICR7bWV0aG9kfSAke2JvZHl9YCk7XG4gICAgY29uc3QgbWVldGluZ05hbWUgPSBwYXRoUGFyYW1zW1wibWVldGluZ05hbWVcIl07XG4gICAgY29uc3QgYXR0ZW5kZWVJZCA9IHBhdGhQYXJhbXNbXCJhdHRlbmRlZUlkXCJdO1xuICAgIGNvbnN0IG9wZXJhdGlvbiA9IHBhdGhQYXJhbXNbXCJvcGVyYXRpb25cIl07XG4gICAgc3dpdGNoIChtZXRob2QpIHtcbiAgICAgICAgY2FzZSBNZXRob2RzLlBPU1Q6XG4gICAgICAgICAgICBpZiAob3BlcmF0aW9uID09PSBPcGVyYXRpb25zLlN0YXJ0VHJhbnNjcmliZSkge1xuICAgICAgICAgICAgICAgIGhhbmRsZVBvc3RTdGFydFRyYW5zY3JpYmUoYWNjZXNzVG9rZW4sIHBhdGhQYXJhbXMsIGJvZHksIGNhbGxiYWNrKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAob3BlcmF0aW9uID09PSBPcGVyYXRpb25zLlN0b3BUcmFuc2NyaWJlKSB7XG4gICAgICAgICAgICAgICAgaGFuZGxlUG9zdFN0b3BUcmFuc2NyaWJlKGFjY2Vzc1Rva2VuLCBwYXRoUGFyYW1zLCBib2R5LCBjYWxsYmFjayk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBVbmtud29uIG1ldGhvZDogJHttZXRob2R9YCk7XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGdlbmVyYXRlUmVzcG9uc2UoeyBzdWNjZXNzOiBmYWxzZSwgY29kZTogQ29kZXMuVU5LTk9XTl9NRVRIT0QgfSk7XG4gICAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXNwb25zZSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICB9XG59O1xuLy8vLyAoNS0xKSBzdGFydCB0cmFuc2NyaWJlXG5jb25zdCBoYW5kbGVQb3N0U3RhcnRUcmFuc2NyaWJlID0gYXN5bmMgKGFjY2Vzc1Rva2VuOiBzdHJpbmcsIHBhdGhQYXJhbXM6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0sIGJvZHk6IGFueSwgY2FsbGJhY2s6IGFueSkgPT4ge1xuICAgIGxldCByZXM6IEhUVFBSZXNwb25zZUJvZHk7XG4gICAgY29uc3QgcGFyYW1zID0gSlNPTi5wYXJzZShib2R5KSBhcyBTdGFydFRyYW5zY3JpYmVSZXF1ZXN0O1xuICAgIGNvbnN0IG1lZXRpbmdOYW1lID0gcGF0aFBhcmFtc1tcIm1lZXRpbmdOYW1lXCJdO1xuICAgIGNvbnN0IGF0dGVuZGVlSWQgPSBwYXRoUGFyYW1zW1wiYXR0ZW5kZWVJZFwiXTtcbiAgICAvLy8vICgxKSBJZiB0aGVyZSBpcyBubyBtZWV0aW5nLCByZXR1cm4gZmFpXG4gICAgbGV0IGVtYWlsID0gXCJcIjtcbiAgICB0cnkge1xuICAgICAgICBlbWFpbCA9IChhd2FpdCBnZXRFbWFpbEZyb21BY2Nlc3NUb2tlbihhY2Nlc3NUb2tlbikpIHx8IFwiXCI7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgICByZXMgPSB7XG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgIGNvZGU6IENvZGVzLk5PX1NVQ0hfQU5fQVRURU5ERUUsXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gZ2VuZXJhdGVSZXNwb25zZShyZXMpO1xuICAgICAgICBjYWxsYmFjayhudWxsLCByZXNwb25zZSk7XG4gICAgfVxuICAgIC8vLyAoMilcbiAgICBzdGFydFRyYW5zY3JpYmUoe1xuICAgICAgICBlbWFpbCxcbiAgICAgICAgbWVldGluZ05hbWUsXG4gICAgICAgIGxhbmc6IHBhcmFtcy5sYW5nLFxuICAgIH0pO1xuICAgIHJlcyA9IHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgY29kZTogQ29kZXMuU1VDQ0VTUyxcbiAgICB9O1xuICAgIGNvbnN0IHJlc3BvbnNlID0gZ2VuZXJhdGVSZXNwb25zZShyZXMpO1xuICAgIGNhbGxiYWNrKG51bGwsIHJlc3BvbnNlKTtcbn07XG4vLy8vICg1LTIpIHN0b3AgdHJhbnNjcmliZVxuY29uc3QgaGFuZGxlUG9zdFN0b3BUcmFuc2NyaWJlID0gYXN5bmMgKGFjY2Vzc1Rva2VuOiBzdHJpbmcsIHBhdGhQYXJhbXM6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0sIGJvZHk6IGFueSwgY2FsbGJhY2s6IGFueSkgPT4ge1xuICAgIGxldCByZXM6IEhUVFBSZXNwb25zZUJvZHk7XG4gICAgY29uc3QgcGFyYW1zID0gSlNPTi5wYXJzZShib2R5KSBhcyBTdG9wVHJhbnNjcmliZVJlcXVlc3Q7XG4gICAgY29uc3QgbWVldGluZ05hbWUgPSBwYXRoUGFyYW1zW1wibWVldGluZ05hbWVcIl07XG4gICAgY29uc3QgYXR0ZW5kZWVJZCA9IHBhdGhQYXJhbXNbXCJhdHRlbmRlZUlkXCJdO1xuICAgIC8vLy8gKDEpIElmIHRoZXJlIGlzIG5vIG1lZXRpbmcsIHJldHVybiBmYWlcbiAgICBsZXQgZW1haWwgPSBcIlwiO1xuICAgIHRyeSB7XG4gICAgICAgIGVtYWlsID0gKGF3YWl0IGdldEVtYWlsRnJvbUFjY2Vzc1Rva2VuKGFjY2Vzc1Rva2VuKSkgfHwgXCJcIjtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHJlcyA9IHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgY29kZTogQ29kZXMuTk9fU1VDSF9BTl9BVFRFTkRFRSxcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBnZW5lcmF0ZVJlc3BvbnNlKHJlcyk7XG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3BvbnNlKTtcbiAgICB9XG4gICAgLy8vICgyKVxuICAgIHN0b3BUcmFuc2NyaWJlKHtcbiAgICAgICAgZW1haWwsXG4gICAgICAgIG1lZXRpbmdOYW1lLFxuICAgIH0pO1xuICAgIHJlcyA9IHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgY29kZTogQ29kZXMuU1VDQ0VTUyxcbiAgICB9O1xuICAgIGNvbnN0IHJlc3BvbnNlID0gZ2VuZXJhdGVSZXNwb25zZShyZXMpO1xuICAgIGNhbGxiYWNrKG51bGwsIHJlc3BvbnNlKTtcbn07XG4iXX0=